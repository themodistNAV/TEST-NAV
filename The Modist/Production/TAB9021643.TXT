OBJECT Table 9021643 Internet Login
{
  OBJECT-PROPERTIES
  {
    Date=13/07/16;
    Time=[ 1:50:04 PM];
    Version List=EC2016.6;
  }
  PROPERTIES
  {
    OnInsert=VAR
               TxtInserted@1000000000 : TextConst 'ENU=Inserted as B2B OnInsert;ENG=Inserted as B2B OnInsert';
               TxtInherited@1000000001 : TextConst 'ENU=Inherited from Customer Role;ENG=Inherited from Customer Role';
             BEGIN
               // EE13.0.1 >>
               IF Rec."Customer No." = '' THEN
                 Rec."Customer No." := Rec.GETFILTER("Customer No.");
               TESTFIELD("Customer No.");
               // EE13.0.1 <<

               Customer.GET("Customer No.");
               IF Customer."Label Code" = '' THEN
                 ERROR(Text75001);
               "Label Code" := Customer."Label Code";

               //DOC EC2013.3.30 InternetShopMgt.Randomize;
               IF "No." = '' THEN BEGIN  //DOC EC2013.4.00 just add BEGIN
                 "No." := CREATEGUID;  //DOC EC2013.3.30
                 "No." := COPYSTR("No.",2,36); //DOC EC2013.3.40
                 //DOC EC2013.3.30 "No." := InternetShopMgt.GenerateGuid;
               END;  //DOC EC2013.4.00 just add END
               IF "Inserted Modified By" <> 'B2BREG' THEN //DOC EC2013.4.00
                 TESTFIELD(Password);
               TESTFIELD("E-Mail");

               IF "Contact No." = '' THEN
                 CreateContactFromIntB2BCust('');
               "Inserted Modified By" := USERID;
               DateTimeInsertedModified := CURRENTDATETIME;

               //DOC EC2013.4.60 -
               WebSecRole.RESET;
               WebSecRole.SETRANGE("Label Code","Label Code");
               WebSecRole.SETRANGE("Is An Excluded Role",TRUE);
               IF WebSecRole.FIND('-') THEN
               REPEAT
                 WebSecUserRole.INIT;
                 WebSecUserRole."Internet Customer No." := "No.";
                 WebSecUserRole."Label Code" := "Label Code";
                 WebSecUserRole."Web Security Role" := WebSecRole.Code;
                 WebSecUserRole."User Type" := WebSecUserRole."User Type"::B2B;
                 WebSecUserRole.Comment := TxtInserted;
                 WebSecUserRole.INSERT(TRUE);
               UNTIL WebSecRole.NEXT = 0;
               //DOC EC2013.4.60 +

               //DOC EC2013.4.63 -
               LabelRec.GET("Label Code");
               IF LabelRec."Login Inherits Cust. User Role" THEN BEGIN
                 WebSecUserRole.RESET;
                 WebSecUserRole.SETCURRENTKEY("Customer No.");
                 WebSecUserRole.SETRANGE("Customer No.","Customer No.");
                 WebSecUserRole.SETRANGE("Label Code","Label Code");
                 WebSecUserRole.SETRANGE("Not For Extract",TRUE);
                 IF WebSecUserRole.FIND('-') THEN
                 REPEAT
                   WebSecUserRole1.RESET;
                   WebSecUserRole1.INIT;
                   WebSecUserRole1."Internet Customer No." := "No.";
                   WebSecUserRole1."Label Code" := "Label Code";
                   WebSecUserRole1."Web Security Role" := WebSecUserRole."Web Security Role";
                   WebSecUserRole1."User Type" := WebSecUserRole1."User Type"::B2B;
                   WebSecUserRole1.Comment := TxtInherited;
                   WebSecUserRole1."Auto Entered Exclude Role Code" :=
                                   WebSecUserRole."Auto Entered Exclude Role Code"; //DOC EC2013.4.63 GW add
                   IF WebSecUserRole1.INSERT(TRUE) THEN; //DOC EC2013.4.63 GW added the IF THEN
                 UNTIL WebSecUserRole.NEXT = 0;
               END;
               //DOC EC2013.4.63 +
             END;

    OnModify=BEGIN
               "Inserted Modified By" := USERID;
               DateTimeInsertedModified := CURRENTDATETIME;
             END;

    OnDelete=BEGIN
               ContactRec.RESET;
               ContactRec.SETCURRENTKEY("User GuID");
               ContactRec.SETRANGE("User GuID","No.");
               IF ContactRec.FINDFIRST THEN BEGIN
                 ContactRec."User GuID" := '';
                 ContactRec."Is An Internet Customer" := FALSE;
                 ContactRec.MODIFY;
               END;

               //DOC EC2013.3.60 -
               WebSecUserRole.RESET;
               WebSecUserRole.SETRANGE("Label Code","Label Code");
               WebSecUserRole.SETRANGE("User Type",WebSecUserRole."User Type"::B2B);
               WebSecUserRole.SETRANGE("Internet Customer No.","No.");
               WebSecUserRole.DELETEALL;
               //DOC EC2013.3.60 +
             END;

    CaptionML=[DAN=Internet-kunde B2B;
               DEU=Internetkunde B2B;
               ENU=Internet Login;
               ESP=Cliente B2B;
               SVE=Internet kund B2B;
               ENG=Internet Login];
    LookupPageID=Page9021681;
    DrillDownPageID=Page9021681;
  }
  FIELDS
  {
    { 1   ;   ;Customer No.        ;Code20        ;TableRelation=Customer;
                                                   CaptionML=[DAN=Kundenummer.;
                                                              DEU=Kunden Nr.;
                                                              ENU=Customer No.;
                                                              ESP=No. Cliente;
                                                              SVE=Kundnr;
                                                              ENG=Customer No.] }
    { 8   ;   ;Contact             ;Text50        ;OnValidate=BEGIN
                                                                ContactRec.RESET;
                                                                ContactRec.SETCURRENTKEY("User GuID");
                                                                ContactRec.SETRANGE("User GuID","No.");
                                                                IF ContactRec.FINDFIRST THEN BEGIN
                                                                  IF ContactRec.Name <> Contact THEN BEGIN
                                                                    ContactRec.Name := Contact;
                                                                    ContactRec.MODIFY;
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=[DAN=Attention;
                                                              DEU=Kontakt;
                                                              ENU=Contact;
                                                              ESP=Contacto;
                                                              SVE=Kontaktperson;
                                                              ENG=Contact];
                                                   Description=EC2016.1.1 changed from 30 to 50 for BioCare }
    { 20  ;   ;Type                ;Option        ;CaptionML=[ENU=Type;
                                                              ENG=Type];
                                                   OptionCaptionML=[ENU=B2B,Salesperson;
                                                                    ENG=B2B,Salesperson];
                                                   OptionString=B2B,Salesperson;
                                                   Description=GW add 140530 }
    { 102 ;   ;E-Mail              ;Text80        ;OnValidate=BEGIN
                                                                IF Enable THEN BEGIN //DOC EC2013.3.30 - new IF
                                                                  IF NOT LabelFunctions.EmailOK("E-Mail") THEN
                                                                    ERROR(Text75004,"E-Mail");
                                                                  VALIDATE(Login,"E-Mail");
                                                                //DOC EC2013.3.30 new code below.
                                                                END ELSE BEGIN
                                                                  Login := "E-Mail";
                                                                  "Code Login" := "E-Mail";
                                                                END;
                                                              END;

                                                   CaptionML=[DAN=E-mail;
                                                              DEU=e-mail;
                                                              ENU=E-Mail;
                                                              ESP=E-Mail;
                                                              SVE=E-post;
                                                              ENG=E-Mail];
                                                   NotBlank=Yes }
    { 38700;  ;No.                 ;Text38        ;CaptionML=[DAN=Nummer;
                                                              DEU=Nr.;
                                                              ENU=No.;
                                                              ESP=No.;
                                                              SVE=Nr;
                                                              ENG=No.] }
    { 38701;  ;Login               ;Text80        ;OnValidate=BEGIN
                                                                VALIDATE("Code Login",Login);
                                                              END;

                                                   CaptionML=[DAN=Login;
                                                              DEU=Anmeldung;
                                                              ENU=Login;
                                                              ESP=Login;
                                                              SVE=Inloggning;
                                                              ENG=Login];
                                                   NotBlank=Yes;
                                                   Description=EC2016.1.1 changed from 20 to 80 }
    { 38702;  ;Password            ;Text40        ;OnValidate=VAR
                                                                i@1000000000 : Integer;
                                                                j@1000000001 : Integer;
                                                              BEGIN
                                                                //DOC EC2013.3.60 -
                                                                FOR i := 1 TO STRLEN(Password) DO
                                                                  IF COPYSTR(Password,i,1) IN ['0'..'9','A'..'Z','a'..'z','_','.','!','-','*','@','?',','] THEN
                                                                    j := 1
                                                                  ELSE
                                                                    ERROR(Text005,COPYSTR(Password,i,1));
                                                                //DOC EC2013.3.60 +

                                                                IF Enable = FALSE THEN
                                                                  ERROR(Text017,FIELDCAPTION(Password));  //DOC EC2013.3.30
                                                                Customer.GET("Customer No.");
                                                                IF Customer."Label Code" = '' THEN
                                                                  ERROR(Text75001);
                                                                "Label Code" := Customer."Label Code";

                                                                IF (InternetShopMgt.Encrypt(Password) <> xRec.Password) AND (CurrFieldNo <> 0) THEN BEGIN
                                                                  MailLoginYesNo("E-Mail", Login, Password);
                                                                END;

                                                                //DOC EC2013.3.30 InternetShopMgt.Randomize;
                                                                //DOC EC2013.3.30 "Password Version" := InternetShopMgt.GenerateGuid();
                                                                "Password Version" := CREATEGUID; //DOC EC2013.3.30
                                                                "Password Version" := COPYSTR("Password Version",2,36); //DOC EC2013.3.40
                                                                IF "Password Version" = xRec."Password Version" THEN
                                                                  ERROR(Text001);

                                                                Password := InternetShopMgt.Encrypt(Password);

                                                                //DOC EC2009.2.71 -
                                                                IF "Multi Account Login" THEN BEGIN
                                                                  InternetLogin.RESET;
                                                                  InternetLogin.SETCURRENTKEY("Code Login");
                                                                  InternetLogin.SETRANGE("Label Code","Label Code");
                                                                  InternetLogin.SETRANGE("Code Login","Code Login");
                                                                  InternetLogin.SETFILTER("No.",'<>%1',"No.");
                                                                  IF InternetLogin.FINDFIRST THEN BEGIN
                                                                    InternetLogin.MODIFYALL(Password,Password);
                                                                    InternetLogin.MODIFYALL("Password Version","Password Version");
                                                                  END;
                                                                END;
                                                                //DOC EC2009.2.71 +
                                                              END;

                                                   CaptionML=[DAN=Kodeord;
                                                              DEU=Passwort;
                                                              ENU=Password;
                                                              ESP=Password;
                                                              SVE=Lîsenord;
                                                              ENG=Password];
                                                   NotBlank=Yes;
                                                   Description=EC2009.2.1 changed from 20 to 40 }
    { 38710;  ;Password Version    ;Text38        ;CaptionML=[DAN=Kodeord Version;
                                                              DEU=Passwort Version;
                                                              ENU=Password Version;
                                                              ESP=Versi¢n de Password;
                                                              SVE=Lîsenordversion;
                                                              ENG=Password Version] }
    { 38711;  ;Enable              ;Boolean       ;InitValue=Yes;
                                                   OnValidate=BEGIN
                                                                IF Enable THEN BEGIN
                                                                  CheckCustomerEnabled;
                                                                  VALIDATE("E-Mail");  //DOC EC2013.3.30
                                                                END ELSE BEGIN
                                                                  IF "Multi Account Login" THEN
                                                                    ERROR(Text018);  //DOC EC2013.3.30
                                                                END;
                                                              END;

                                                   CaptionML=[DAN=Aktiv;
                                                              DEU=Mîglich;
                                                              ENU=Enable;
                                                              ESP=Activo;
                                                              SVE=Aktivera;
                                                              ENG=Enable] }
    { 75000;  ;Label Code          ;Code10        ;TableRelation=Label;
                                                   OnValidate=BEGIN
                                                                ERROR(Text75000);
                                                              END;

                                                   CaptionML=[ENU=Label Code;
                                                              ENG=Label Code];
                                                   Description=EC2016.6;
                                                   Editable=No }
    { 75001;  ;Internet Customer Exists;Boolean   ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Internet Customers" WHERE (No.=FIELD(No.)));
                                                   CaptionML=[ENU=Internet Customer Exists;
                                                              ENG=Internet Customer Exists];
                                                   Description=flowfield GW add 100929,editable no;
                                                   Editable=No }
    { 75002;  ;Contact Exists      ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist(Contact WHERE (No.=FIELD(Contact No.)));
                                                   CaptionML=[ENU=Contact Exists;
                                                              ENG=Contact Exists];
                                                   Description=flowfield GW add 100929, editable no;
                                                   Editable=No }
    { 75009;  ;Contact No.         ;Code20        ;TableRelation=Contact;
                                                   CaptionML=[ENU=Contact No.;
                                                              ENG=Contact No.];
                                                   Description=EC2016.6;
                                                   Editable=No }
    { 76000;  ;Code Login          ;Code80        ;OnValidate=BEGIN
                                                                IF "Label Code" = '' THEN BEGIN
                                                                  Customer.GET("Customer No.");
                                                                  Customer.TESTFIELD("Label Code");  //DOC EC2013.3.30
                                                                  "Label Code" := Customer."Label Code";
                                                                END;

                                                                //DOC EC2009.2.71 -
                                                                IF "Multi Account Login" THEN BEGIN
                                                                  InternetCustomer.RESET;
                                                                  InternetCustomer.SETCURRENTKEY(Login);
                                                                  InternetCustomer.SETRANGE("Label Code","Label Code");
                                                                  InternetCustomer.SETRANGE(Login,"Code Login");
                                                                  IF "No." <> '' THEN
                                                                    InternetCustomer.SETFILTER("No.",'<>%1',"No.");

                                                                  IF InternetCustomer.FIND('-') THEN
                                                                  REPEAT
                                                                    InternetCustomer.CALCFIELDS("B2B Customer");
                                                                    //DOC EC2009.2.74 -
                                                                    //Extra code to overcome problem of creating a new Login where a previous Login existed that has been deleted.
                                                                    //Orig IF InternetCustomer."B2B Customer" = FALSE THEN
                                                                    //Orig  ERROR(Text75003,Login,InternetCustomer."No.",InternetCustomer.Contact);
                                                                    IF InternetCustomer."B2B Customer" = FALSE THEN BEGIN
                                                                      //DOC EC2013.3.61 - Always error if same email address is being used.
                                                                      ERROR(Text75003,Login,InternetCustomer."No.",InternetCustomer.Contact);
                                                                      {
                                                                      IF InternetCustomer."Customer No." = '' THEN BEGIN
                                                                        //Error here OK because if Customer No is blank could not have come from Internet B2B Customer
                                                                        //CONFIRM not necessary but left in in case it is.
                                                                        //IF NOT CONFIRM('Only click YES if you are MQ and you know you want to click YES!' +
                                                                        //               '\\Everyone else should click NO!!',FALSE) THEN
                                                                        ERROR(Text75003,Login,InternetCustomer."No.",InternetCustomer.Contact);
                                                                      END ELSE BEGIN
                                                                        IF Customer2.GET(InternetCustomer."Customer No.") THEN BEGIN
                                                                          IF Customer2."User GUID" = InternetCustomer."No." THEN
                                                                            //Error here OK because Internet Customer and Customer have same GUID so Internet Customer
                                                                            //did not result from a deleted Internet B2B Customer
                                                                            //CONFIRM not necessary but left in in case it is.
                                                                            //IF NOT CONFIRM('Only click YES if you are MQ and you know you want to click YES!' +
                                                                            //               '\\Everyone else should click NO!!',FALSE) THEN
                                                                            ERROR(Text75003,Login,InternetCustomer."No.",InternetCustomer.Contact);
                                                                        END;
                                                                      END;
                                                                      }
                                                                      //DOC EC2013.3.61 +
                                                                    END;
                                                                    //DOC EC2009.2.74 +
                                                                  UNTIL InternetCustomer.NEXT = 0;

                                                                  InternetLogin.RESET;
                                                                  InternetLogin.SETCURRENTKEY("Code Login");
                                                                  InternetLogin.SETRANGE("Label Code","Label Code");
                                                                  InternetLogin.SETRANGE("Code Login","Code Login");
                                                                  InternetLogin.SETFILTER("No.",'<>%1',"No.");
                                                                  InternetLogin.SETRANGE("Multi Account Login",FALSE);
                                                                  InternetLogin.SETRANGE(Enable,TRUE);  //DOC EC2013.3.61
                                                                  IF InternetLogin.FINDFIRST THEN
                                                                    ERROR(Text75006,InternetLogin."Contact No.",InternetLogin."Customer No.");

                                                                  InternetLogin.SETRANGE("Multi Account Login",TRUE);
                                                                  IF "Customer No." = '' THEN
                                                                    ERROR('Customer No. cannot be blank');
                                                                  InternetLogin.SETRANGE("Customer No.","Customer No.");
                                                                  IF InternetLogin.FINDFIRST THEN
                                                                    ERROR(Text75007,"Customer No.");
                                                                  InternetLogin.SETRANGE("Customer No.");
                                                                  IF InternetLogin.FINDFIRST THEN BEGIN
                                                                    //DOC EC2009.2.72 -
                                                                    IF GUIALLOWED THEN
                                                                      IF HideDialogeConst = FALSE THEN //DOC EC2013.4.00
                                                                        MESSAGE(Text75009);
                                                                    //DOC EC2009.2.72 +
                                                                    Password := InternetLogin.Password;
                                                                    "Password Version" := InternetLogin."Password Version";
                                                                  END;
                                                                  //DOC EC2009.2.72 -
                                                                  IF xRec."Code Login" <> '' THEN BEGIN
                                                                    InternetLogin.SETRANGE("Code Login",xRec."Code Login");
                                                                    IF InternetLogin.FIND('-') THEN BEGIN
                                                                      //DOC EC2013.3.61 MQ 18/07/2013 - GW130718 do not think need this IF GUIALLOWED THEN BEGIN
                                                                      IF CONFIRM(Text75008,TRUE,InternetLogin.COUNT,xRec."Code Login") THEN BEGIN
                                                                        REPEAT
                                                                          InternetLogin2 := InternetLogin;
                                                                          InternetLogin2."E-Mail" := "E-Mail";
                                                                          InternetLogin2.Login := Login;
                                                                          InternetLogin2."Code Login" := "Code Login";
                                                                          InternetLogin2.Password := Password;
                                                                          InternetLogin2."Password Version" := "Password Version";
                                                                          InternetLogin2.MODIFY;
                                                                        UNTIL InternetLogin.NEXT = 0;
                                                                      END
                                                                      //DOC EC2013.3.50 -
                                                                      ELSE
                                                                        CheckUniqueEmail;
                                                                      //DOC EC2013.3.50 +
                                                                      //DOC EC2013.3.61 END;
                                                                    END;
                                                                  END;
                                                                  //DOC EC2009.2.72 +
                                                                END ELSE
                                                                  CheckUniqueEmail; //Code that was here moved to function
                                                                //DOC EC2009.2.71 +

                                                                InternetCustomer.RESET;
                                                                IF InternetCustomer.GET("No.") THEN BEGIN
                                                                  "IntCus Login When Change Login" := InternetCustomer.Login;
                                                                  "DateTime Login From Int. Cust." := CURRENTDATETIME;
                                                                END;

                                                                ContactRec.RESET;
                                                                ContactRec.SETCURRENTKEY("User GuID");
                                                                ContactRec.SETRANGE("User GuID","No.");
                                                                IF ContactRec.FINDFIRST THEN BEGIN
                                                                  IF ContactRec."E-Mail" <> "E-Mail" THEN BEGIN
                                                                    ContactRec."E-Mail" := "E-Mail";
                                                                    ContactRec."Search E-Mail" := "E-Mail"; //MQ 21/02/2011 - GW110221 added line
                                                                    ContactRec.MODIFY;
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Code Login;
                                                              ENG=Code Login];
                                                   Description=EC2016.1.1 }
    { 76002;  ;DateTimeInsertedModified;DateTime  ;CaptionML=[ENU=DateTimeInsertedModified;
                                                              ENG=DateTimeInsertedModified] }
    { 76004;  ;Inserted Modified By;Code40        ;CaptionML=[ENU=Inserted Modified By;
                                                              ENG=Inserted Modified By];
                                                   Description=MQ 10/01/2014 - GW140110 was C20 }
    { 76010;  ;IntCus Login When Change Login;Code80;
                                                   CaptionML=[ENU=IntCus Login When Change Login;
                                                              ENG=IntCus Login When Change Login];
                                                   Description=GW add 110221 }
    { 76011;  ;DateTime Login From Int. Cust.;DateTime;
                                                   CaptionML=[ENU=DateTime Login From Int. Cust.;
                                                              ENG=DateTime Login From Int. Cust.];
                                                   Description=GW add 110221 }
    { 76014;  ;Multi Account Login ;Boolean       ;OnValidate=BEGIN
                                                                IF Enable = FALSE THEN
                                                                  ERROR(Text017,FIELDCAPTION("Multi Account Login"));  //DOC EC2013.3.30
                                                                IF "Label Code" = '' THEN BEGIN
                                                                  Customer.GET("Customer No.");
                                                                  IF Customer."Label Code" = '' THEN
                                                                    ERROR(Text75001);
                                                                  "Label Code" := Customer."Label Code";
                                                                END;
                                                                IF "Multi Account Login" THEN BEGIN
                                                                  LabelRec.GET("Label Code");
                                                                  IF LabelRec."Allow Multi Account Logins" = FALSE THEN
                                                                    ERROR(Text75005,"Label Code");
                                                                END ELSE
                                                                  IF "E-Mail" <> '' THEN //DOC EC2013.3.30
                                                                    CheckUniqueEmail;
                                                              END;

                                                   CaptionML=[ENU=Multi Account Login;
                                                              ENG=Multi Account Login];
                                                   Description=GW add 111214 }
    { 76016;  ;Same Password as Int. Cust.;Boolean;FieldClass=FlowField;
                                                   CalcFormula=Exist("Internet Customers" WHERE (No.=FIELD(No.),
                                                                                                 Customer No.=FIELD(Customer No.),
                                                                                                 Password=FIELD(Password)));
                                                   CaptionML=[ENU=Same Password as Int. Cust.;
                                                              ENG=Same Password as Int. Cust.];
                                                   Description=GW add 121205;
                                                   Editable=No }
    { 76017;  ;IntCus Exist With Same Cust No;Boolean;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Exist("Internet Customers" WHERE (No.=FIELD(No.),
                                                                                                 Customer No.=FIELD(Customer No.)));
                                                   OnValidate=BEGIN
                                                                //MQ 06/12/2012 - GW121206 The situation should never exist when the Cust No. is not the same where No. is the same.
                                                                //between Int. Cust and Int. B2B Cust. This allows a quick check that there are no records.
                                                              END;

                                                   CaptionML=[ENU=IntCus Exist With Same Cust No;
                                                              ENG=IntCus Exist With Same Cust No];
                                                   Description=GW add 121205;
                                                   Editable=No }
  }
  KEYS
  {
    {    ;No.                                     ;Clustered=Yes }
    {    ;Customer No.                             }
    {    ;Code Login,No.                           }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      Customer@1000000000 : Record 18;
      InternetCustomer@1000000001 : Record 9021642;
      InternetLogin@1000000003 : Record 9021643;
      InternetLogin2@1190000010 : Record 9021643;
      Text000@1000000007 : TextConst 'DAN=Login %1 er allerede i brug.;DEU=Anmeldung %1 ist bereits aktiv.;ENU=Login %1 is already in use.;ESP=Login %1 ya est† en uso.;SVE=Inloggad %1 anvÑnds redan.;ENG=Login %1 is already in use.';
      Text001@1000000008 : TextConst 'DAN=Fejl ved kryptering af kodeord. Prõv igen.;DEU=Fehler beim entschlÅsseln des Passworts. Bitte versuchen Sie es nochmals.;ENU=Error encrypting password. Please try again.;ESP=Error encriptando password. IntÇntelo de nuevo.;SVE=Felaktigt lîsenord. V.g fîrsîk igen.;ENG=Error encrypting password. Please try again.';
      Text002@1000000009 : TextConst 'DAN=Der er blevet skiftet kodeord pÜ Kunden. ùnsker du at sende\;DEU=Das Passwort wurde verÑndert. WÅnsche Sie das\;ENU=The password has been changed. Would you like\;ESP=La password ha cambiado. ®Desea\;SVE=Lîsenordet har Ñndrats. Vill ni\;ENG=The password has been changed. Would you like\';
      Text003@1000000010 : TextConst 'DAN=en mail med det nye kodeord til kunden?;DEU=Neue Anmeldeinformationen dem Kunden senden?;ENU=to send the new login information to the customer?;ESP=enviar la nueva informaci¢n de acceso al cliente?;SVE=skicka den nya inloggningsinformationen till kunden?;ENG=to send the new login information to the customer?';
      Text004@1000000011 : TextConst 'DAN=Advarsel: %1 er slÜet fra pÜ %2 %3.;DEU=Warnung: Shop Anmeldung ist nicht mîglich fÅr %1 %2.;ENU=Warning: The Is a B2B Internet Customer is not ticked for %1 %2.;ESP=Atenci¢n: Accesos a tienda no activados para %1 %2.;SVE=Varning: Shop inloggning Ñr inte aktiverade fîr %1 %2.;ENG=Warning: The Is a B2B Internet Customer is not ticked for %1 %2.';
      LabelRec@1040001 : Record 9021618;
      Text005@1000000013 : TextConst 'ENU=Sorry, you have used an invalid character of %1 in the password, please try again.\\You can only use A to Z, a to z, 0 to 9, .,!-_*@ and ?.;ENG=Sorry, you have used an invalid character of %1 in the password, please try again.\\You can only use A to Z, a to z, 0 to 9, .,!-_*@ and ?.';
      Text75000@1040002 : TextConst 'ENU=You cannot change the label code.;ENG=You cannot change the label code.';
      Text75001@1040003 : TextConst 'ENU=The Customer''s Label Code is blank.  Please fill this in on the Customer before creating Log Ins.;ENG=The Customer''s Label Code is blank.  Please fill this in on the Customer before creating Log Ins.';
      ContBusRel@1040004 : Record 5054;
      CompanyContactRec@1040005 : Record 5050;
      ContactRec@1040006 : Record 5050;
      Text008@1040007 : TextConst 'ENU=Email address %1 is already in use in Internet Login with Customer No. %2, Contact %3 but is not a Multi Account Login.\\If you want to use this email address here you first need to tick the Multi Account Login on the other account.;ENG=Email address %1 is already in use in Internet Login with Customer No. %2, Contact %3 but is not a Multi Account Login.\\If you want to use this email address here you first need to tick the Multi Account Login on the other account.';
      Text75003@1040008 : TextConst 'ENU=Email address %1 is already in use in Internet Customer No. %2, Contact %3.;ENG=Email address %1 is already in use in Internet Customer No. %2, Contact %3.';
      Customer2@1040011 : Record 18;
      WebSecRole@1000000016 : Record 9021730;
      WebSecUserRole@1000000006 : Record 9021731;
      LabelFunctions@1040009 : Codeunit 9021619;
      Text75004@1040010 : TextConst 'ENU=%1 is an invalid Email address.;ENG=%1 is an invalid Email address.';
      Text75005@1190000005 : TextConst 'ENU=The Label %1 does not allow this.;ENG=The Label %1 does not allow this.';
      Text75006@1190000007 : TextConst 'ENU=Internet B2B Customer Contact No. %1 for Customer No. %2 has the same Email but is not set as Multiple Login.  You need to tick this on this Internet B2B Customer first.;ENG=Internet B2B Customer Contact No. %1 for Customer No. %2 has the same Email but is not set as Multiple Login.  You need to tick this on this Internet B2B Customer first.';
      Text75007@1190000008 : TextConst 'ENU=You cannot setup more than one Login for the same Customer %1 with the same Email address even when Multiple Account Logins is true.;ENG=You cannot setup more than one Login for the same Customer %1 with the same Email address even when Multiple Account Logins is true.';
      Text75008@1190000009 : TextConst 'ENU=There is/are %1 other logins with the previous email address of %2, do you wish to change these as well?;ENG=There is/are %1 other logins with the previous email address of %2, do you wish to change these as well?';
      Text75009@1190000011 : TextConst 'ENU=There is/are other logins with this email address.  The password has been set on this login to the password of the other login(s).;ENG=There is/are other logins with this email address.  The password has been set on this login to the password of the other login(s).';
      Text016@1040012 : TextConst 'ENU=You cannot delete Logins.  Please disable instead.;ENG=You cannot delete Logins.  Please disable instead.';
      NoSeriesMgt@1040014 : Codeunit 396;
      InternetShopMgt@1040013 : Codeunit 9021610;
      WarningShown@1040000 : Boolean;
      CountOfRecords@1040015 : Integer;
      Text017@1000000004 : TextConst 'ENU=You cannot change the %1 when the Login is not Enabled.;ENG=You cannot change the %1 when the Login is not Enabled.';
      Text018@1000000005 : TextConst 'ENU=You cannot disable a Multi Account Login.;ENG=You cannot disable a Multi Account Login.';
      Text019@1000000012 : TextConst 'ENU=Email address %1 is already in use in Internet Login with Customer No. %2, Contact %3 that is a Multi Account Login so this account must also be a Multi Account Login.;ENG=Email address %1 is already in use in Internet Login with Customer No. %2, Contact %3 that is a Multi Account Login so this account must also be a Multi Account Login.';
      HideDialogeConst@1000000014 : Boolean;
      WebSecUserRole1@1000000015 : Record 9021731;

    PROCEDURE MailLoginYesNo@1("E-Mail"@1000000000 : Text[80];Login@1000000001 : Text[80];Password@1000000002 : Text[20]);
    BEGIN
      IF CONFIRM (Text002 +
                  Text003
                  ,TRUE,TABLENAME)
      THEN
        InternetShopMgt.InternetNewLoginInfo("E-Mail", Login, Password,"Label Code",
                                             "Customer No.");
    END;

    PROCEDURE CheckCustomerEnabled@2();
    BEGIN
      IF Customer.GET("Customer No.") THEN
        IF NOT Customer."Is a B2B Internet Customer" THEN
          IF HideDialogeConst = FALSE THEN //DOC EC2013.4.00
            MESSAGE(Text004, Customer.TABLENAME, Customer."No.");
    END;

    PROCEDURE CreateContactFromIntB2BCust@1040001(ContactNo@1000000000 : Code[20]);
    VAR
      TextL000@1000000001 : TextConst 'ENU=Error in CreateContact. Cannot find Contact in Contact Business Relationship for Customer in CreateContact. (L000);ENG=Error in CreateContact. Cannot find Contact in Contact Business Relationship for Customer in CreateContact. (L000)';
      TextL001@1000000002 : TextConst 'ENU=Error in CreateContact. Cannot get Contact %1 for Customer in CreateContact. (L001);ENG=Error in CreateContact. Cannot get Contact %1 for Customer in CreateContact. (L001)';
      TextL002@1000000003 : TextConst 'ENU=Error in CreateContact.  Supplied Contact No. is %1 but found Contact No. %2 with match User Guid. (L002);ENG=Error in CreateContact.  Supplied Contact No. is %1 but found Contact No. %2 with match User Guid. (L002)';
      TextL003@1000000004 : TextConst 'ENU=Error in CreateContact.  Supplied Contact No. is %1 but found Contact No. %2 with match Email. (L003);ENG=Error in CreateContact.  Supplied Contact No. is %1 but found Contact No. %2 with match Email. (L003)';
      TextL004@1000000005 : TextConst 'ENU=Error in CreateContact. There is more than one contact for Email address %1.  Use the Link to Contact function. (L004);ENG=Error in CreateContact. There is more than one contact for Email address %1.  Use the Link to Contact function. (L004)';
      ModContact@1000000006 : Boolean;
    BEGIN
      ContBusRel.RESET;
      ContBusRel.SETCURRENTKEY("Link to Table","No.");
      ContBusRel.SETRANGE("Link to Table",ContBusRel."Link to Table"::Customer);
      ContBusRel.SETRANGE("No.","Customer No.");
      IF NOT ContBusRel.FINDFIRST THEN
        ERROR(TextL000);

      IF NOT CompanyContactRec.GET(ContBusRel."Contact No.") THEN
        ERROR(TextL001,ContBusRel."Contact No.");

      ContactRec.RESET;
      ContactRec.SETCURRENTKEY("Company No.");
      ContactRec.SETRANGE("Company No.",CompanyContactRec."No.");
      ContactRec.SETRANGE("User GuID",Rec."No.");
      ContactRec.SETRANGE(Type,ContactRec.Type::Person); //MQ 06/04/2011 - GW110406
      IF ContactRec.FINDFIRST THEN BEGIN
        IF (ContactNo <> '') AND (ContactNo <> ContactRec."No.") THEN
          ERROR(TextL002,ContactNo,ContactRec."No.");
        "Contact No." := ContactRec."No.";
        ModContact := FALSE;
        Customer.GET("Customer No.");
        IF ContactRec."Is An Internet Customer" <> Customer."Is An Internet Customer" THEN BEGIN
          ModContact := TRUE;
          ContactRec.VALIDATE("Is An Internet Customer",Customer."Is An Internet Customer");
        END;
        IF ContactRec."Label Code" <> Customer."Label Code" THEN BEGIN
          ModContact := TRUE;
          ContactRec."Label Code" := Customer."Label Code";
        END;
        IF ModContact THEN BEGIN
          ContactRec."Last Date Modified" := TODAY;
          ContactRec.MODIFY;
        END;
      END ELSE BEGIN
        ContactRec.SETRANGE("User GuID");
        ContactRec.SETRANGE("E-Mail",Rec."E-Mail");
        IF ContactRec.FINDFIRST THEN BEGIN
          IF ContactRec.COUNT > 1 THEN
            ERROR(TextL004);
          IF (ContactNo <> '') AND (ContactNo <> ContactRec."No.") THEN
            ERROR(TextL003,ContactNo,ContactRec."No.");
          "Contact No." := ContactRec."No.";
          ContactRec."User GuID" := Rec."No.";
          Customer.GET("Customer No.");
          ContactRec."Label Code" := Customer."Label Code";
          ContactRec.VALIDATE("Is An Internet Customer",Customer."Is An Internet Customer");
          ContactRec."Last Date Modified" := TODAY;
          ContactRec.MODIFY;
        END ELSE BEGIN
          ContactRec.INIT;
          ContactRec."No." := ContactNo;
          ContactRec.INSERT(TRUE);
          ContactRec."Company No." := CompanyContactRec."No.";
          ContactRec.VALIDATE(Type,ContactRec.Type::Person);
          ContactRec."User GuID" := "No.";
          ContactRec.InheritCompanyToPersonData(CompanyContactRec,FALSE);
          ContactRec.VALIDATE("E-Mail","E-Mail");
          ContactRec.VALIDATE(Name,Rec.Contact);
          Customer.GET("Customer No.");
          ContactRec."Label Code" := Customer."Label Code";
          ContactRec.VALIDATE("Is An Internet Customer",Customer."Is An Internet Customer");
          ContactRec."Last Date Modified" := TODAY;
          ContactRec.MODIFY;
          "Contact No." := ContactRec."No.";
        END;
      END;
    END;

    PROCEDURE CheckUniqueEmail@1190000006();
    BEGIN
      CLEAR(InternetLogin);
      CLEAR(InternetCustomer);

      InternetLogin.RESET;
      InternetLogin.SETCURRENTKEY("Code Login");
      InternetLogin.SETRANGE("Label Code","Label Code");
      InternetLogin.SETRANGE("Code Login","Code Login");
      InternetLogin.SETRANGE(Enable,TRUE);
      IF "No." <> '' THEN
        InternetLogin.SETFILTER("No.",'<>%1',"No.");

      InternetLogin.SETRANGE("Multi Account Login",FALSE); //DOC EC2013.3.61
      IF InternetLogin.FINDFIRST  THEN
        ERROR(Text008,Login,InternetLogin."Customer No.",InternetLogin.Contact);

      //DOC EC2013.3.61 -
      InternetLogin.SETRANGE("Multi Account Login",TRUE);
      IF InternetLogin.FINDFIRST THEN BEGIN
          ERROR(Text019,Login,InternetLogin."Customer No.",InternetLogin.Contact);
      END;
      //DOC EC2013.3.61 +

      InternetCustomer.RESET;
      InternetCustomer.SETCURRENTKEY(Login);
      InternetCustomer.SETRANGE("Label Code","Label Code");
      InternetCustomer.SETRANGE(Login,"Code Login");
      IF "No." <> '' THEN
        InternetCustomer.SETFILTER("No.",'<>%1',"No.");
      //DOC EC2013.3.61 -
      //Orig IF InternetCustomer.FINDFIRST THEN
      IF InternetCustomer.FIND('-') THEN
        REPEAT
          InternetCustomer.CALCFIELDS("B2B Customer");
          IF InternetCustomer."B2B Customer" = FALSE THEN
          //DOC EC2013.3.61 +
            ERROR(Text75003,Login,InternetCustomer."No.",InternetCustomer.Contact);
        UNTIL InternetCustomer.NEXT = 0; //DOC EC2013.3.61
    END;

    PROCEDURE HideDialogue@1000000000();
    BEGIN
      HideDialogeConst := TRUE;
    END;

    BEGIN
    {
      //DOC EC2013.3.30 MQ 21/11/2012 - GW121121 Line too long for Text conversion to V5.  Made 2 lines
      //DOC EC2013.3.30 MQ 26/11/2012 - GW121126 Additonal code dealing with if B2B in not Enabled.
      //DOC EC2013.3.30 MQ 06/12/2012 - GW121206 Add fields 76016 Same Password as Int. Cust. and 76017 IntCus Exist With Same Cust No
      //DOC EC2013.3.30 MQ 06/12/2012 - Remove InternetShopMgt.GenerateGuid and just call standard CREATEGUID
      //DOC EC2013.4.00 MQ 10/01/2014 - GW140110 Made Inserted Modified By C40
      //DOC EC2013.4.60 MQ 21/03/2014 - GW140321 Auto add to Excluded User Role in OnInsert
      //DOC EC2013.4.63 MQ 08/05/2014 - SB140508 Code in OnInsert() to inherit security roles from customer
      //DOC EC2013.4.63 MQ 27/05/2014 - GW140527 Enhanced with a SETCURRENTKEY and an IF THEN
      //DOC EC2013.4.64 MQ 06/06/2014 - GW140606 Changed name from Internet B2B Customer to Internet Login and added field Type
      //DOC EC2013.4.64 MQ 13/06/2014 - GW140613 Add EE13.0.1
      //DOC EC2016.6    JH 05/10/2016 - ECom 2016
    }
    END.
  }
}

