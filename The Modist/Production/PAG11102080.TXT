OBJECT Page 11102080 OM - Import Objects Worksheet
{
  OBJECT-PROPERTIES
  {
    Date=19/11/15;
    Time=12:00:00 PM;
    Version List=OMA10.00;
  }
  PROPERTIES
  {
    CaptionML=[DEU=Import Objects Worksheet;
               ENU=Import Objects Worksheet;
               ESP=Import Objects Worksheet;
               FRA=Import Objects Worksheet;
               NLD=Objecten importeerwerkblad;
               DEA=Import Objects Worksheet];
    SaveValues=Yes;
    InsertAllowed=No;
    SourceTable=Table11102079;
    PageType=Worksheet;
    SourceTableTemporary=Yes;
    OnInit=BEGIN
             SetEditable;
           END;

    OnOpenPage=BEGIN
                 RESET;

                 OnOpenForm;

                 IF ImportedFileName <> '' THEN
                   ImportFileName := ImportedFileName;
               END;

    OnFindRecord=BEGIN
                   IF NOT CanSetSelection THEN
                     RESET;

                   EXIT(FIND(Which));
                 END;

    OnNextRecord=BEGIN
                   IF NOT CanSetSelection THEN
                     RESET;

                   EXIT(NEXT(Steps));
                 END;

    OnModifyRecord=BEGIN
                     EXIT(CanSetSelection);
                   END;

    OnDeleteRecord=BEGIN
                     EXIT(CanSetSelection);
                   END;

    ActionList=ACTIONS
    {
      { 1       ;0   ;ActionContainer;
                      ActionContainerType=ActionItems }
      { 2       ;1   ;ActionGroup;
                      CaptionML=[DEU=F&unctions;
                                 ENU=F&unctions;
                                 ESP=F&unctions;
                                 FRA=F&unctions;
                                 NLD=F&uncties;
                                 DEA=F&unctions] }
      { 3       ;2   ;ActionGroup;
                      CaptionML=[DEU=Open;
                                 ENU=Open;
                                 ESP=Open;
                                 FRA=Open;
                                 NLD=Openen;
                                 DEA=Open];
                      Image=Add }
      { 4       ;3   ;Action    ;
                      ShortCutKey=Ctrl+O;
                      Ellipsis=Yes;
                      CaptionML=[DEU=Open;
                                 ENU=Open;
                                 ESP=Open;
                                 FRA=Open;
                                 NLD=Openen;
                                 DEA=Open];
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=Add;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 TmpCALHistoryObject2@1000 : TEMPORARY Record 11102052;
                                 TmpCALHistoryLine2@1001 : TEMPORARY Record 11102053;
                                 TmpObject2@1002 : TEMPORARY Record 2000000001;
                                 TmpObject3@1003 : TEMPORARY Record 2000000001;
                                 TmpObjectHeaders@1004 : TEMPORARY Record 2000000001;
                                 ImExportMgt@1005 : Codeunit 11102043;
                                 Progressbar@1006 : Codeunit 11102044;
                                 SourceControl@1007 : Codeunit 11102050;
                                 CommonDialog@1008 : Codeunit 11102059;
                                 ImportTransport@1009 : Codeunit 11102087;
                                 FileHandler@1010 : Codeunit 11102097;
                                 oFile@1011 : File;
                                 InStr@1012 : InStream;
                                 OutStr@1013 : OutStream;
                                 ServerFileName@1014 : Text;
                                 ctExtAll@1015 : TextConst 'DEU="All Object Files|*.fob;*.fib;*.txt;*.obp";ENU="All Object Files|*.fob;*.fib;*.txt;*.obp";ESP="All Object Files|*.fob;*.fib;*.txt;*.obp";FRA="All Object Files|*.fob;*.fib;*.txt;*.obp";NLD="All Object Files|*.fob;*.fib;*.txt;*.obp";DEA="All Object Files|*.fob;*.fib;*.txt;*.obp"';
                                 ctImportingTextfile@1016 : TextConst 'DEU=Importing textfile...;ENU=Importing textfile...;ESP=Importing textfile...;FRA=Importing textfile...;NLD=Tekstbestand importeren...;DEA=Importing textfile...';
                                 ctNotValid@1017 : TextConst 'DEU=The extension ''%1'' is not valid.;ENU=The extension ''%1'' is not valid.;ESP=The extension ''%1'' is not valid.;FRA=The extension ''%1'' is not valid.;NLD=De extensie ''%1'' is niet geldig.;DEA=The extension ''%1'' is not valid.';
                               BEGIN
                                 CommonDialog.AddExtension(ctExtAll, '');
                                 CommonDialog.AddKnownExtension('fob');
                                 CommonDialog.AddKnownExtension('fib');
                                 CommonDialog.AddKnownExtension('txt');
                                 CommonDialog.AddKnownExtension('obp');

                                 IF STRLEN(ImportFileName) > 2 THEN
                                   CASE LOWERCASE(COPYSTR(ImportFileName, STRLEN(ImportFileName) - 2)) OF
                                     'fob' : CommonDialog.SetDialogFilterIndex(2);
                                     'fib' : CommonDialog.SetDialogFilterIndex(3);
                                     'txt' : CommonDialog.SetDialogFilterIndex(4);
                                     'obp' : CommonDialog.SetDialogFilterIndex(5);
                                   END;

                                 IF NOT CommonDialog.OpenFile(ImportFileName, ServerFileName) THEN
                                   EXIT;

                                 CASE CommonDialog.GetExtension OF
                                   'fob' :
                                     BEGIN

                                       ResetLines;

                                       oFile.OPEN(ServerFileName);
                                       oFile.CREATEINSTREAM(InStr);

                                       ImExportMgt.GetObjectHeadersFromFob(InStr, TmpObjectHeaders);
                                       SetFobHeaders(TmpObjectHeaders);

                                       oFile.CLOSE;

                                       FobFileName := ServerFileName;
                                       SetEditable;

                                     END;

                                   'obp' :
                                     BEGIN

                                       IF ImportType <> ImportType::Properties THEN
                                         ResetLines;

                                       ImExportMgt.ImportObpFromFile(ServerFileName, TmpObject2);
                                       IF TmpObject2.FINDSET THEN
                                         REPEAT
                                           IF GET("Line Type"::"Import Worksheet", TmpObject2.Type, TmpObject2.ID) THEN
                                             DELETE;
                                         UNTIL TmpObject2.NEXT = 0;
                                       SetObjectProperties(TmpObject2);

                                     END;

                                   'fib' :
                                     BEGIN

                                       ResetLines;

                                       ImportTransport.ReadSections(ServerFileName, TmpObject3);
                                       TmpObject3.SETRANGE("Company Name", 'FOB');
                                       TmpObject3.FINDFIRST;
                                       TmpObject3.CALCFIELDS("BLOB Reference");
                                       TmpObject3."BLOB Reference".CREATEINSTREAM(InStr);

                                       FobFileName := FileHandler.CreateServerTempFileName('fob');
                                       oFile.CREATE(FobFileName);
                                       oFile.CREATEOUTSTREAM(OutStr);
                                       COPYSTREAM(OutStr, InStr);
                                       oFile.CLOSE;

                                       TmpObject3."BLOB Reference".CREATEINSTREAM(InStr);
                                       ImExportMgt.GetObjectHeadersFromFob(InStr, TmpObjectHeaders);
                                       SetFobHeaders(TmpObjectHeaders);

                                       SetEditable;

                                     END;

                                   'txt' :
                                     BEGIN

                                       IF ImportType <> ImportType::Text THEN
                                         ResetLines;

                                       Progressbar.Open(ctImportingTextfile, 1);
                                       Progressbar.BarSize := ImExportMgt.LengthOfFile(ServerFileName);

                                       TmpCALHistoryObject.RESET;
                                       IF TmpCALHistoryObject.FINDLAST THEN
                                         TmpCALHistoryObject2."Entry No." := TmpCALHistoryObject."Entry No.";
                                       TmpCALHistoryObject2."Entry No." += 1;

                                       SourceControl.ImportTextFile2(ServerFileName, 1, Progressbar, 0, TmpCALHistoryObject2, TmpCALHistoryLine2, TRUE);

                                       IF TmpCALHistoryObject2.FINDSET THEN
                                         REPEAT
                                           TmpCALHistoryObject.SETCURRENTKEY("Object Type", "Object No.");
                                           TmpCALHistoryObject.SETRANGE("Object Type", TmpCALHistoryObject2."Object Type");
                                           TmpCALHistoryObject.SETRANGE("Object No.", TmpCALHistoryObject2."Object No.");

                                           IF TmpCALHistoryObject.FINDFIRST THEN BEGIN
                                             TmpCALHistoryObject.DELETE;
                                             TmpCALHistoryLine.SETRANGE("Entry No.", TmpCALHistoryObject."Entry No.");
                                             TmpCALHistoryLine.DELETEALL;
                                           END;

                                           IF GET("Line Type"::"Import Worksheet", TmpCALHistoryObject2."Object Type", TmpCALHistoryObject2."Object No.") THEN
                                             DELETE;

                                         UNTIL TmpCALHistoryObject2.NEXT = 0;

                                       SetCALCodeObjects(TmpCALHistoryObject2, TmpCALHistoryLine2);
                                       SetEditable;
                                     END;

                                   ELSE
                                     MESSAGE(ctNotValid, LOWERCASE(COPYSTR(ImportFileName, STRLEN(ImportFileName) - 2)));
                                 END;

                                 OnOpenForm;
                               END;
                                }
      { 5       ;3   ;Action    ;
                      Ellipsis=Yes;
                      CaptionML=[DEU=Open S&plitted Text Files;
                                 ENU=Open S&plitted Text Files;
                                 ESP=Open S&plitted Text Files;
                                 FRA=Open S&plitted Text Files;
                                 NLD=Gescheiden tekstbestanden openen;
                                 DEA=Open S&plitted Text Files];
                      Image=ViewPage;
                      OnAction=VAR
                                 TmpCALHistoryObject2@1000 : TEMPORARY Record 11102052;
                                 TmpCALHistoryLine2@1001 : TEMPORARY Record 11102053;
                                 TmpFile@1002 : TEMPORARY Record 11102094;
                                 Object@1003 : Record 2000000001;
                                 Progressbar@1004 : Codeunit 11102044;
                                 SourceControl@1005 : Codeunit 11102050;
                                 CommonDialog@1006 : Codeunit 11102059;
                                 FileHandler@1007 : Codeunit 11102097;
                                 oFile@1008 : File;
                                 ClientDirectoryName@1009 : Text;
                                 ObjectLine@1010 : Text[1024];
                                 ServerFileName@1011 : Text;
                                 ctImportingObjects@1012 : TextConst 'DEU=Importing objects...;ENU=Importing objects...;ESP=Importing objects...;FRA=Importing objects...;NLD=Objecten importeren...;DEA=Importing objects...';
                               BEGIN
                                 CommonDialog.SelectDirectory(ClientDirectoryName);

                                 IF ClientDirectoryName = '' THEN
                                   EXIT;

                                 IF ImportType <> ImportType::Text THEN BEGIN
                                   RESET;
                                   DELETEALL;

                                   TmpCALHistoryObject.RESET;
                                   TmpCALHistoryObject.DELETEALL;

                                   TmpCALHistoryLine.RESET;
                                   TmpCALHistoryLine.DELETEALL;
                                 END;

                                 IF ClientDirectoryName[STRLEN(ClientDirectoryName)] <> '\' THEN
                                   ClientDirectoryName += '\';

                                 Progressbar.Open(ctImportingObjects, 1);

                                 FileHandler.GetClientDirectoryContent(TmpFile, ClientDirectoryName);
                                 TmpFile.SETFILTER(Name, '*.txt|*.TXT');
                                 IF TmpFile.FINDSET THEN BEGIN
                                   Progressbar.BarSize := TmpFile.COUNT;

                                   REPEAT

                                     ServerFileName := FileHandler.UploadToServer(ClientDirectoryName + TmpFile.Name, '');

                                     Progressbar.AddToBar(1);

                                     oFile.WRITEMODE(FALSE);
                                     oFile.TEXTMODE(TRUE);
                                     oFile.OPEN(ServerFileName);
                                     oFile.READ(ObjectLine);
                                     oFile.CLOSE;

                                     SourceControl.GetObjectProperties(Object, ObjectLine);
                                     Progressbar.Text1Object := Object;

                                     TmpCALHistoryObject.RESET;
                                     IF TmpCALHistoryObject.FINDLAST THEN
                                       TmpCALHistoryObject2."Entry No." := TmpCALHistoryObject."Entry No.";
                                     TmpCALHistoryObject2."Entry No." += 1;

                                     SourceControl.ImportTextFile2(ServerFileName, 0, Progressbar, 0, TmpCALHistoryObject2, TmpCALHistoryLine2, TRUE);

                                     IF TmpCALHistoryObject2.FINDSET THEN
                                       REPEAT
                                         TmpCALHistoryObject.SETCURRENTKEY("Object Type", "Object No.");
                                         TmpCALHistoryObject.SETRANGE("Object Type", TmpCALHistoryObject2."Object Type");
                                         TmpCALHistoryObject.SETRANGE("Object No.", TmpCALHistoryObject2."Object No.");

                                         IF TmpCALHistoryObject.FINDFIRST THEN BEGIN
                                           TmpCALHistoryObject.DELETE;
                                           TmpCALHistoryLine.SETRANGE("Entry No.", TmpCALHistoryObject."Entry No.");
                                           TmpCALHistoryLine.DELETEALL;
                                         END;

                                         Type := TmpCALHistoryObject2."Object Type";
                                         "No." := TmpCALHistoryObject2."Object No.";
                                         IF FIND('=') THEN
                                           DELETE;

                                       UNTIL TmpCALHistoryObject2.NEXT = 0;

                                     SetCALCodeObjects(TmpCALHistoryObject2, TmpCALHistoryLine2);

                                   UNTIL TmpFile.NEXT = 0;

                                 END;

                                 Progressbar.Close;

                                 SetEditable;
                                 OnOpenForm;
                               END;
                                }
      { 58      ;3   ;Action    ;
                      Ellipsis=Yes;
                      CaptionML=[DEU=Open S&plitted FOB;
                                 ENU=Open S&plitted FOB;
                                 ESP=Open S&plitted FOB;
                                 FRA=Open S&plitted FOB;
                                 NLD=Gescheiden FOB openen;
                                 DEA=Open S&plitted FOB];
                      Image=ViewPage;
                      OnAction=VAR
                                 TmpFile@1000 : TEMPORARY Record 11102094;
                                 TmpObject@1001 : TEMPORARY Record 2000000001;
                                 ImExportMgt@1002 : Codeunit 11102043;
                                 Progressbar@1003 : Codeunit 11102044;
                                 CommonDialog@1004 : Codeunit 11102059;
                                 FileHandler@1005 : Codeunit 11102097;
                                 oFile@1006 : File;
                                 InStr@1007 : InStream;
                                 ClientDirectoryName@1008 : Text;
                                 ServerFileName@1009 : Text;
                                 ctImportingObjects@1010 : TextConst 'DEU=Importing objects...;ENU=Importing objects...;ESP=Importing objects...;FRA=Importing objects...;NLD=Objecten importeren...;DEA=Importing objects...';
                                 ctMultipleObjects@1011 : TextConst 'DEU=%1 contains more then one object.\It cannot be imported in a split FOB import.;ENU=%1 contains more then one object.\It cannot be imported in a split FOB import.;ESP=%1 contains more then one object.\It cannot be imported in a split FOB import.;FRA=%1 contains more then one object.\It cannot be imported in a split FOB import.;NLD=%1 bevat meer dan ‚‚n object.\Dit bestand kan niet worden ge‹mporteerd in een gescheiden FOB import.;DEA=%1 contains more then one object.\It cannot be imported in a split FOB import.';
                               BEGIN
                                 CommonDialog.SelectDirectory(ClientDirectoryName);

                                 IF ClientDirectoryName = '' THEN
                                   EXIT;

                                 IF ImportType <> ImportType::"Splitted FOB" THEN BEGIN
                                   RESET;
                                   DELETEALL;

                                   TmpCALHistoryObject.RESET;
                                   TmpCALHistoryObject.DELETEALL;

                                   TmpCALHistoryLine.RESET;
                                   TmpCALHistoryLine.DELETEALL;
                                 END;

                                 IF ClientDirectoryName[STRLEN(ClientDirectoryName)] <> '\' THEN
                                   ClientDirectoryName += '\';

                                 Progressbar.Open(ctImportingObjects, 1);

                                 FileHandler.GetClientDirectoryContent(TmpFile, ClientDirectoryName);
                                 TmpFile.SETFILTER(Name, '*.fob|*.FOB');
                                 IF TmpFile.FINDSET THEN BEGIN
                                   Progressbar.BarSize := TmpFile.COUNT;

                                   REPEAT

                                     Progressbar.AddToBar(1);

                                     ServerFileName := FileHandler.UploadToServer(ClientDirectoryName + TmpFile.Name, '');

                                     TmpObject.RESET;
                                     TmpObject.DELETEALL;

                                     oFile.OPEN(ServerFileName);
                                     oFile.CREATEINSTREAM(InStr);

                                     ImExportMgt.GetObjectHeadersFromFob(InStr, TmpObject);
                                     oFile.CLOSE;

                                     IF TmpObject.COUNT > 1 THEN
                                       ERROR(ctMultipleObjects, TmpFile.Name);

                                     Progressbar.Text1Object := TmpObject;

                                     TmpObject."BLOB Reference".IMPORT(ServerFileName);
                                     SetSplitFobRecord(TmpObject);

                                   UNTIL TmpFile.NEXT = 0;

                                 END;

                                 Progressbar.Close;

                                 SetEditable;

                                 OnOpenForm;
                               END;
                                }
      { 6       ;2   ;ActionGroup;
                      CaptionML=[DEU=Save;
                                 ENU=Save;
                                 ESP=Save;
                                 FRA=Save;
                                 NLD=Opslaan;
                                 DEA=Save];
                      Image=Save }
      { 7       ;3   ;Action    ;
                      Ellipsis=Yes;
                      CaptionML=[DEU=Save As;
                                 ENU=Save As;
                                 ESP=Save As;
                                 FRA=Save As;
                                 NLD=Opslaan &als;
                                 DEA=Save As];
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=Save;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 TmpObjectImportLine@1000 : TEMPORARY Record 11102079;
                                 CommonDialog@1001 : Codeunit 11102059;
                                 FileHandler@1002 : Codeunit 11102097;
                                 ChosenExtension@1003 : Text;
                                 DefaultFileName@1004 : Text;
                                 ServerFileName@1005 : Text;
                                 ctDefaultFileNameFob@1006 : TextConst 'DEU=objects.fob;ENU=objects.fob;ESP=objects.fob;FRA=objects.fob;NLD=objects.fob;DEA=objects.fob';
                                 ctDefaultFileNameTxt@1007 : TextConst 'DEU=objects.txt;ENU=objects.txt;ESP=objects.txt;FRA=objects.txt;NLD=objects.txt;DEA=objects.txt';
                               BEGIN
                                 GetSelectedRecords(TmpObjectImportLine);

                                 CASE ImportType OF

                                   ImportType::" " :
                                     EXIT;

                                   ImportType::Binary :
                                     NoSupportedError;

                                   ImportType::Text :
                                     BEGIN
                                       CommonDialog.AddKnownExtension('txt-o');
                                       CommonDialog.AddKnownExtension('obp');
                                       DefaultFileName := ctDefaultFileNameTxt;
                                       ChosenExtension := 'txt-0';
                                     END;

                                   ImportType::Properties :
                                     BEGIN
                                       CommonDialog.AddKnownExtension('obp');
                                       DefaultFileName := ctDefaultFileNameTxt;
                                       ChosenExtension := 'obp';
                                     END;

                                   ImportType::Fob :
                                     BEGIN
                                       CommonDialog.AddKnownExtension('fob');
                                       DefaultFileName := ctDefaultFileNameFob;
                                       ChosenExtension := 'fob';
                                     END;

                                   ImportType::"Splitted FOB" :
                                     BEGIN
                                       ExportSplitFob;
                                       EXIT;
                                     END;

                                 END;

                                 IF NOT CommonDialog.SaveFile(ExportFileName, ServerFileName, DefaultFileName) THEN
                                   EXIT;

                                 IF NOT FileHandler.IsWebClient THEN
                                   ChosenExtension := CommonDialog.GetExtension;

                                 CASE ChosenExtension OF
                                   'fob' :
                                     BEGIN
                                       IF ImportType <> ImportType::Fob THEN
                                         NoSupportedError;
                                       ExportFob(ServerFileName);
                                     END;

                                   'obp' :
                                     BEGIN
                                       IF ImportType IN [ImportType::" ", ImportType::Fob] THEN
                                         NoSupportedError;

                                       ExportPropertiesFile(TmpObjectImportLine, ServerFileName);
                                     END;

                                   'txt', 'txt-o' :
                                     BEGIN
                                       IF ImportType IN [ImportType::" ", ImportType::Properties, ImportType::Fob] THEN
                                         NoSupportedError;

                                       ExportTextFile(TmpObjectImportLine, ServerFileName);
                                     END;

                                 END;

                                 FileHandler.DownloadToClient(ServerFileName, ExportFileName, DefaultFileName);
                               END;
                                }
      { 8       ;3   ;Action    ;
                      Ellipsis=Yes;
                      CaptionML=[DEU=Save Sp&litted Text Files;
                                 ENU=Save Sp&litted Text Files;
                                 ESP=Save Sp&litted Text Files;
                                 FRA=Save Sp&litted Text Files;
                                 NLD=Gescheiden &tekstbestanden opslaan;
                                 DEA=Save Sp&litted Text Files];
                      Enabled=TextOptionsEditable;
                      Image=ListPage;
                      OnAction=VAR
                                 TmpObjectImportLine@1000 : TEMPORARY Record 11102079;
                                 Progressbar@1001 : Codeunit 11102044;
                                 SourceControl@1002 : Codeunit 11102050;
                                 CommonDialog@1003 : Codeunit 11102059;
                                 FileNameMgt@1004 : Codeunit 11102107;
                                 FileName@1005 : Text;
                                 PathToExport@1006 : Text;
                                 ctExportingObjects@1007 : TextConst 'DEU=Exporting objects...;ENU=Exporting objects...;ESP=Exporting objects...;FRA=Exporting objects...;NLD=Objecten exporteren...;DEA=Exporting objects...';
                                 ctObjectHeader@1008 : TextConst 'DEU=OBJECT %1 %2 %3;ENU=OBJECT %1 %2 %3;ESP=OBJECT %1 %2 %3;FRA=OBJECT %1 %2 %3;NLD=OBJECT %1 %2 %3;DEA=OBJECT %1 %2 %3';
                               BEGIN
                                 TestTextImport;

                                 CommonDialog.SelectDirectory(PathToExport);

                                 IF PathToExport = '' THEN
                                   EXIT;

                                 Progressbar.Open(ctExportingObjects, 1);
                                 Progressbar.BarSize := COUNT;

                                 GetSelectedRecords(TmpObjectImportLine);

                                 WITH TmpObjectImportLine DO
                                   IF FINDSET THEN
                                     REPEAT

                                       Progressbar.AddToBar(1);
                                       Progressbar.Text1 := FORMAT(Type) + ' ' + FORMAT("No.") + ' ' + Name;

                                       TmpCALHistoryObject.RESET;
                                       TmpCALHistoryObject.SETCURRENTKEY("Object Type", "Object No.");
                                       TmpCALHistoryObject.SETRANGE("Object Type", Type);
                                       TmpCALHistoryObject.SETRANGE("Object No.", "No.");
                                       TmpCALHistoryObject.FINDFIRST;

                                       TmpCALHistoryLine.SETRANGE("Entry No.", TmpCALHistoryObject."Entry No.");
                                       TmpCALHistoryLine.FINDFIRST;
                                       TmpCALHistoryLine.Code := STRSUBSTNO(ctObjectHeader, Type, "New Object No.", "New Name");
                                       TmpCALHistoryLine.MODIFY;

                                       FileName := PathToExport + FileNameMgt.FileName(Type, "New Object No.", "New Name");

                                       SourceControl.ExportTextFile(FileName, TmpCALHistoryLine);

                                     UNTIL NEXT = 0;

                                 Progressbar.Close;
                               END;
                                }
      { 9       ;2   ;Separator  }
      { 10      ;2   ;Action    ;
                      CaptionML=[DEU=Show Changes in &Directory;
                                 ENU=Show Changes in &Directory;
                                 ESP=Show Changes in &Directory;
                                 FRA=Show Changes in &Directory;
                                 NLD=Toon wijzigingen in &map;
                                 DEA=Show Changes in &Directory];
                      Enabled=TextOptionsEditable;
                      Image=ViewPage;
                      OnAction=VAR
                                 TmpCALHistoryObject2@1000 : TEMPORARY Record 11102052;
                                 TmpObjectImportLine@1001 : TEMPORARY Record 11102079;
                                 SourceControl@1002 : Codeunit 11102050;
                                 FileHandler@1003 : Codeunit 11102097;
                                 FileNameMgt@1004 : Codeunit 11102107;
                                 oFile@1005 : File;
                                 ClientDirectory@1006 : Text;
                                 FileName@1007 : Text;
                                 LeftServerDirectory@1008 : Text;
                                 RightServerDirectory@1009 : Text;
                                 ServerDirectory@1010 : Text;
                               BEGIN
                                 TestTextImport;

                                 ServerDirectory := FileHandler.CreateServerDirectory;

                                 LeftServerDirectory := ServerDirectory + 'objects-to-import\';
                                 RightServerDirectory := ServerDirectory + 'objects-in-database\';

                                 FileHandler.CheckCreateServerDirectory(LeftServerDirectory);
                                 FileHandler.CheckCreateServerDirectory(RightServerDirectory);

                                 GetSelectedRecords(TmpObjectImportLine);

                                 CheckCALHistory(Rec);

                                 IF FINDSET THEN
                                   REPEAT

                                     TmpCALHistoryObject.RESET;
                                     TmpCALHistoryObject.SETCURRENTKEY("Object Type", "Object No.");
                                     TmpCALHistoryObject.SETRANGE("Object Type", Type);
                                     TmpCALHistoryObject.SETRANGE("Object No.", "No.");
                                     IF TmpCALHistoryObject.FINDLAST THEN BEGIN

                                       FileName :=
                                         FileNameMgt.FileName(
                                           TmpCALHistoryObject."Object Type", TmpCALHistoryObject."Object No.", TmpCALHistoryObject."Object Name");

                                       oFile.TEXTMODE(TRUE);
                                       oFile.WRITEMODE(TRUE);
                                       oFile.CREATE(LeftServerDirectory + FileName);

                                       TmpCALHistoryLine.SETRANGE("Entry No.", TmpCALHistoryObject."Entry No.");
                                       SourceControl.AppendHistoryLinesToFile(oFile, TmpCALHistoryLine);

                                       oFile.CLOSE;

                                       SourceControl.SetStampToFile(
                                         LeftServerDirectory + FileName, TmpCALHistoryObject."Object Date", TmpCALHistoryObject."Object Time");

                                     END;

                                   UNTIL NEXT = 0;

                                 GetCALHistoryObject(TmpCALHistoryObject2);
                                 SourceControl.ExportRangeToDirectory(TmpCALHistoryObject2, RightServerDirectory);

                                 ClientDirectory := FileHandler.DownloadDirectoryToClient(ServerDirectory, '');

                                 SourceControl.StartCompareToolDirectory(ClientDirectory + 'objects-to-import\', ClientDirectory + 'objects-in-database\');
                               END;
                                }
      { 11      ;2   ;Action    ;
                      CaptionML=[DEU=Show Changes in One &File;
                                 ENU=Show Changes in One &File;
                                 ESP=Show Changes in One &File;
                                 FRA=Show Changes in One &File;
                                 NLD=Toon wijzigingen in ‚‚n &bestand;
                                 DEA=Show Changes in One &File];
                      Enabled=TextOptionsEditable;
                      Image=ViewDocumentLine;
                      OnAction=VAR
                                 TmpCALHistoryObject2@1000 : TEMPORARY Record 11102052;
                                 TmpObjectImportLine@1001 : TEMPORARY Record 11102079;
                                 SourceControl@1002 : Codeunit 11102050;
                                 FileHandler@1003 : Codeunit 11102097;
                                 oFile@1004 : File;
                                 Directory@1005 : Text;
                                 LeftClientFileName@1006 : Text;
                                 LeftServerFileName@1007 : Text;
                                 RightClientFileName@1008 : Text;
                                 RightServerFileName@1009 : Text;
                               BEGIN
                                 TestTextImport;

                                 Directory := FileHandler.TempDirectory;

                                 LeftServerFileName := Directory + 'objects-to-import.txt';

                                 oFile.TEXTMODE(TRUE);
                                 oFile.WRITEMODE(TRUE);
                                 oFile.CREATE(LeftServerFileName);

                                 GetSelectedRecords(TmpObjectImportLine);

                                 CheckCALHistory(Rec);

                                 IF FINDSET THEN
                                   REPEAT

                                     TmpCALHistoryObject.RESET;
                                     TmpCALHistoryObject.SETCURRENTKEY("Object Type", "Object No.");
                                     TmpCALHistoryObject.SETRANGE("Object Type", Type);
                                     TmpCALHistoryObject.SETRANGE("Object No.", "No.");
                                     IF TmpCALHistoryObject.FINDLAST THEN BEGIN

                                       TmpCALHistoryLine.SETRANGE("Entry No.", TmpCALHistoryObject."Entry No.");
                                       SourceControl.AppendHistoryLinesToFile(oFile, TmpCALHistoryLine);

                                     END;

                                   UNTIL NEXT = 0;

                                 oFile.CLOSE;

                                 GetCALHistoryObject(TmpCALHistoryObject2);
                                 RightServerFileName := Directory + 'objects-in-database.txt';
                                 SourceControl.ExportRangeToFile(TmpCALHistoryObject2, RightServerFileName);

                                 LeftClientFileName := FileHandler.DownloadToClient(LeftServerFileName, '', '');
                                 RightClientFileName := FileHandler.DownloadToClient(RightServerFileName, '', '');

                                 SourceControl.StartCompareToolFile(LeftClientFileName, RightClientFileName);
                               END;
                                }
      { 12      ;2   ;Separator  }
      { 13      ;2   ;ActionGroup;
                      CaptionML=[DEU=&Set Actions;
                                 ENU=&Set Actions;
                                 ESP=&Set Actions;
                                 FRA=&Set Actions;
                                 NLD=&Zet acties;
                                 DEA=&Set Actions];
                      Enabled=ActionEditable;
                      Image=AddAction }
      { 14      ;3   ;Action    ;
                      CaptionML=[DEU=Replace;
                                 ENU=Replace;
                                 ESP=Replace;
                                 FRA=Replace;
                                 NLD=Overschrijven;
                                 DEA=Replace];
                      Enabled=ActionEditable;
                      Image=Import;
                      OnAction=BEGIN
                                 ErrorIfProperties;
                                 SetImportActions("Import Action"::Replace);
                               END;
                                }
      { 15      ;3   ;Action    ;
                      CaptionML=[DEU=Replace and &Compile;
                                 ENU=Replace and &Compile;
                                 ESP=Replace and &Compile;
                                 FRA=Replace and &Compile;
                                 NLD=Overschrijven en &compileren;
                                 DEA=Replace and &Compile];
                      Enabled=ActionEditable;
                      Image=ImportLog;
                      OnAction=BEGIN
                                 ErrorIfProperties;
                                 SetImportActions("Import Action"::"Replace and Compile");
                               END;
                                }
      { 16      ;3   ;Action    ;
                      CaptionML=[DEU=Import &Properties;
                                 ENU=Import &Properties;
                                 ESP=Import &Properties;
                                 FRA=Import &Properties;
                                 NLD=Eigenschappen importeren;
                                 DEA=Import &Properties];
                      Enabled=ActionEditable;
                      Image=Insert;
                      OnAction=BEGIN
                                 SetImportActions("Import Action"::"Import Properties");
                               END;
                                }
      { 17      ;3   ;Action    ;
                      CaptionML=[DEU=Skip;
                                 ENU=Skip;
                                 ESP=Skip;
                                 FRA=Skip;
                                 NLD=Over&slaan;
                                 DEA=Skip];
                      Enabled=ActionEditable;
                      Image=Cancel;
                      OnAction=BEGIN
                                 SetImportActions("Import Action"::Skip);
                               END;
                                }
      { 18      ;2   ;ActionGroup;
                      CaptionML=[DEU=Mark Objects;
                                 ENU=Mark Objects;
                                 ESP=Mark Objects;
                                 FRA=Mark Objects;
                                 NLD=Ob&jecten markeren;
                                 DEA=Mark Objects];
                      Image=EditFilter }
      { 19      ;3   ;Action    ;
                      ShortCutKey=Ctrl+M;
                      CaptionML=[DEU=Mark Objects;
                                 ENU=Mark Objects;
                                 ESP=Mark Objects;
                                 FRA=Mark Objects;
                                 NLD=Objecten markeren;
                                 DEA=Mark Objects];
                      Image=EditFilter;
                      OnAction=VAR
                                 Object@1000 : Record 2000000001;
                                 VersionControl@1001 : Codeunit 11102040;
                               BEGIN
                                 VersionControl.CheckMarkLock;

                                 CurrPage.SETSELECTIONFILTER(Rec);
                                 IF FINDSET THEN
                                   REPEAT
                                     IF Object.GET(Type, '', "No.") THEN
                                       VersionControl.MarkObject(Object, TRUE);
                                   UNTIL NEXT = 0;
                               END;
                                }
      { 20      ;3   ;Action    ;
                      CaptionML=[DEU=Remove Marks;
                                 ENU=Remove Marks;
                                 ESP=Remove Marks;
                                 FRA=Remove Marks;
                                 NLD=Verwijder markeringen;
                                 DEA=Remove Marks];
                      Image=RemoveFilterLines;
                      OnAction=VAR
                                 Object@1000 : Record 2000000001;
                                 VersionControl@1001 : Codeunit 11102040;
                               BEGIN
                                 CurrPage.SETSELECTIONFILTER(Rec);
                                 IF FINDSET THEN
                                   REPEAT
                                     IF Object.GET(Type, '', "No.") THEN
                                       VersionControl.RemoveObjectMark(Object);
                                   UNTIL NEXT = 0;

                                 VersionControl.RemoveMarkLock(TRUE);
                               END;
                                }
      { 21      ;3   ;Action    ;
                      ShortCutKey=Shift+Ctrl+M;
                      CaptionML=[DEU=Remove &all Marks;
                                 ENU=Remove &all Marks;
                                 ESP=Remove &all Marks;
                                 FRA=Remove &all Marks;
                                 NLD=Verwijder &alle markeringen;
                                 DEA=Remove &all Marks];
                      Image=ClearFilter;
                      OnAction=VAR
                                 VersionControl@1000 : Codeunit 11102040;
                               BEGIN
                                 VersionControl.RemoveObjectMarks(FALSE);
                               END;
                                }
      { 22      ;2   ;Separator  }
      { 23      ;2   ;Action    ;
                      CaptionML=[DEU=Import;
                                 ENU=Import;
                                 ESP=Import;
                                 FRA=Import;
                                 NLD=Importeren;
                                 DEA=Import];
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=ImportDatabase;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 FINDSET;
                                 ImportObjects2;
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 24  ;0   ;Container ;
                ContainerType=ContentArea }

    { 25  ;1   ;Group     ;
                GroupType=Repeater }

    { 26  ;2   ;Field     ;
                SourceExpr=Type;
                Editable=FALSE }

    { 27  ;2   ;Field     ;
                SourceExpr="New Object No.";
                Editable=ObjectEditable }

    { 28  ;2   ;Field     ;
                SourceExpr="New Name";
                Editable=ObjectEditable }

    { 29  ;2   ;Field     ;
                SourceExpr="New Modified";
                Visible=FALSE;
                Editable=FALSE }

    { 30  ;2   ;Field     ;
                SourceExpr="New Version List";
                Editable=FALSE }

    { 31  ;2   ;Field     ;
                SourceExpr="New Date";
                Editable=FALSE }

    { 32  ;2   ;Field     ;
                SourceExpr="New Time";
                Editable=FALSE }

    { 33  ;2   ;Field     ;
                SourceExpr="New Compiled";
                Visible=FALSE;
                Editable=FALSE }

    { 34  ;2   ;Field     ;
                SourceExpr="Import Action";
                Editable=ActionEditable;
                OnValidate=BEGIN
                             IF "Import Action" IN ["Import Action"::Replace, "Import Action"::"Replace and Compile"] THEN
                               ErrorIfProperties;
                           END;
                            }

    { 35  ;2   ;Field     ;
                SourceExpr=Different;
                Editable=FALSE }

    { 36  ;2   ;Field     ;
                SourceExpr=New;
                Editable=FALSE }

    { 37  ;2   ;Field     ;
                SourceExpr="Existing Name";
                Editable=FALSE }

    { 38  ;2   ;Field     ;
                SourceExpr="Existing Modified";
                Visible=FALSE;
                Editable=FALSE }

    { 39  ;2   ;Field     ;
                SourceExpr="Existing Version List";
                Editable=FALSE }

    { 40  ;2   ;Field     ;
                SourceExpr="Existing Date";
                Editable=FALSE }

    { 41  ;2   ;Field     ;
                SourceExpr="Existing Time";
                Editable=FALSE }

    { 42  ;2   ;Field     ;
                SourceExpr="Existing Compiled";
                Visible=FALSE;
                Editable=FALSE }

    { 43  ;1   ;Group     ;
                GroupType=Group }

    { 44  ;2   ;Group     ;
                CaptionML=[DEU=Existing;
                           ENU=Existing;
                           ESP=Existing;
                           FRA=Existing;
                           NLD=Huidig;
                           DEA=Existing];
                GroupType=Group }

    { 45  ;3   ;Field     ;
                Name=ExistingName;
                CaptionML=[DEU=Name;
                           ENU=Name;
                           ESP=Name;
                           FRA=Name;
                           NLD=Naam;
                           DEA=Name];
                SourceExpr="Existing Name";
                Editable=FALSE }

    { 46  ;3   ;Field     ;
                Name=ExistingModified;
                CaptionML=[DEU=Modified;
                           ENU=Modified;
                           ESP=Modified;
                           FRA=Modified;
                           NLD=Gewijzigd;
                           DEA=Modified];
                SourceExpr="Existing Modified";
                Editable=FALSE }

    { 47  ;3   ;Field     ;
                Name=ExistingVersionList;
                CaptionML=[DEU=Version List;
                           ENU=Version List;
                           ESP=Version List;
                           FRA=Version List;
                           NLD=Versielijst;
                           DEA=Version List];
                SourceExpr="Existing Version List";
                Editable=FALSE }

    { 48  ;3   ;Field     ;
                Name=ExistingDate;
                CaptionML=[DEU=Date;
                           ENU=Date;
                           ESP=Date;
                           FRA=Date;
                           NLD=Datum;
                           DEA=Date];
                SourceExpr="Existing Date";
                Editable=FALSE }

    { 49  ;3   ;Field     ;
                Name=ExistingTime;
                CaptionML=[DEU=Time;
                           ENU=Time;
                           ESP=Time;
                           FRA=Time;
                           NLD=Tijd;
                           DEA=Time];
                SourceExpr="Existing Time";
                Editable=FALSE }

    { 50  ;2   ;Group     ;
                CaptionML=[DEU=New;
                           ENU=New;
                           ESP=New;
                           FRA=New;
                           NLD=Nieuw;
                           DEA=New];
                GroupType=Group }

    { 51  ;3   ;Field     ;
                Name=NewName;
                CaptionML=[DEU=Name;
                           ENU=Name;
                           ESP=Name;
                           FRA=Name;
                           NLD=Naam;
                           DEA=Name];
                SourceExpr="New Name";
                Editable=FALSE }

    { 52  ;3   ;Field     ;
                Name=NewModified;
                CaptionML=[DEU=Modified;
                           ENU=Modified;
                           ESP=Modified;
                           FRA=Modified;
                           NLD=Gewijzigd;
                           DEA=Modified];
                SourceExpr="New Modified";
                Editable=FALSE }

    { 53  ;3   ;Field     ;
                Name=NewVersionList;
                CaptionML=[DEU=Version List;
                           ENU=Version List;
                           ESP=Version List;
                           FRA=Version List;
                           NLD=Versielijst;
                           DEA=Version List];
                SourceExpr="New Version List";
                Editable=FALSE }

    { 54  ;3   ;Field     ;
                Name=NewDate;
                CaptionML=[DEU=Date;
                           ENU=Date;
                           ESP=Date;
                           FRA=Date;
                           NLD=Datum;
                           DEA=Date];
                SourceExpr="New Date";
                Editable=FALSE }

    { 55  ;3   ;Field     ;
                Name=NewTime;
                CaptionML=[DEU=Time;
                           ENU=Time;
                           ESP=Time;
                           FRA=Time;
                           NLD=Tijd;
                           DEA=Time];
                SourceExpr="New Time";
                Editable=FALSE }

    { 56  ;1   ;Field     ;
                SourceExpr=ImportFileName;
                Visible=FALSE }

    { 57  ;1   ;Field     ;
                SourceExpr=ExportFileName;
                Visible=FALSE }

  }
  CODE
  {
    VAR
      TmpCALHistoryObject@1000 : TEMPORARY Record 11102052;
      TmpCALHistoryLine@1001 : TEMPORARY Record 11102053;
      ExportFileName@1002 : Text;
      FobFileName@1003 : Text;
      ImportedFileName@1004 : Text;
      ImportFileName@1005 : Text;
      ImportType@1006 : ' ,Binary,Text,Properties,Fob,Splitted FOB';
      ActionEditable@1007 : Boolean INDATASET;
      CanSetSelection@1008 : Boolean;
      ObjectEditable@1009 : Boolean INDATASET;
      TextOptionsEditable@1010 : Boolean INDATASET;

    PROCEDURE SetObjectProperties@1(VAR Object@1000 : Record 2000000001);
    BEGIN
      IF Object.FINDSET THEN
        REPEAT

          INIT;
          "Line Type" := "Line Type"::"Import Worksheet";
          Type := Object.Type;
          "No." := Object.ID;
          Name := Object.Name;
          "New Object No." := Object.ID;
          "New Name" := Object.Name;
          "New Modified" := Object.Modified;
          "New Version List" := Object."Version List";
          "New Date" := Object.Date;
          "New Time" := Object.Time;
          "New Compiled" := Object.Compiled;
          INSERT(TRUE);

          FillLeftRight(Rec);
          MODIFY;

        UNTIL Object.NEXT = 0;

      ImportType := ImportType::Properties;

      SetEditable;
    END;

    PROCEDURE SetFobHeaders@2(VAR Object@1000 : Record 2000000001);
    BEGIN
      IF Object.FINDSET THEN
        REPEAT

          INIT;
          "Line Type" := "Line Type"::"Import Worksheet";
          Type := Object.Type;
          "No." := Object.ID;
          Name := Object.Name;
          "New Object No." := Object.ID;
          "New Name" := Object.Name;
          "New Modified" := Object.Modified;
          "New Version List" := Object."Version List";
          "New Date" := Object.Date;
          "New Time" := Object.Time;
          "New Compiled" := Object.Compiled;
          INSERT(TRUE);

          FillLeftRight(Rec);
          MODIFY;

        UNTIL Object.NEXT = 0;

      ImportType := ImportType::Fob;

      SetEditable;
    END;

    PROCEDURE SetSplitFob@20(VAR Object@1000 : Record 2000000001);
    BEGIN
      IF Object.FINDSET THEN
        REPEAT
          SetSplitFobRecord(Object);
        UNTIL Object.NEXT = 0;

      ImportType := ImportType::"Splitted FOB";

      SetEditable;
    END;

    LOCAL PROCEDURE SetSplitFobRecord@22(VAR Object@1000 : Record 2000000001);
    BEGIN
      IF GET("Line Type"::"Import Worksheet", Object.Type, Object.ID) THEN
        DELETE;

      INIT;
      "Line Type" := "Line Type"::"Import Worksheet";
      Type := Object.Type;
      "No." := Object.ID;
      Name := Object.Name;
      "New Object No." := Object.ID;
      "New Name" := Object.Name;
      "New Modified" := Object.Modified;
      "New Version List" := Object."Version List";
      "New Date" := Object.Date;
      "New Time" := Object.Time;
      "New Compiled" := Object.Compiled;
      Object.CALCFIELDS("BLOB Reference");
      "BLOB Reference" := Object."BLOB Reference";
      INSERT(TRUE);

      FillLeftRight(Rec);
      MODIFY;
    END;

    PROCEDURE SetCALCodeObjects@3(VAR NewCALHistoryObject@1000 : Record 11102052;VAR NewCALHistoryLine@1001 : Record 11102053);
    VAR
      ctObjectDoubleInFile@1002 : TextConst 'DEU=Object %1 %2 %3 already present.;ENU=Object %1 %2 %3 already present.;ESP=Object %1 %2 %3 already present.;FRA=Object %1 %2 %3 already present.;NLD=Object %1 %2 %3 reeds aanwezig.;DEA=Object %1 %2 %3 already present.';
    BEGIN
      IF NewCALHistoryObject.FINDSET THEN
        REPEAT
          TmpCALHistoryObject := NewCALHistoryObject;
          TmpCALHistoryObject.INSERT;

          IF GET("Line Type"::"Import Worksheet", NewCALHistoryObject."Object Type", NewCALHistoryObject."Object No.") THEN BEGIN
            DELETE;
            ERROR(
              ctObjectDoubleInFile,
              NewCALHistoryObject."Object Type", NewCALHistoryObject."Object No.", NewCALHistoryObject."Object Name");
          END;

          INIT;
          "Line Type" := "Line Type"::"Import Worksheet";
          Type := NewCALHistoryObject."Object Type";
          "No." := NewCALHistoryObject."Object No.";
          "New Object No." := NewCALHistoryObject."Object No.";
          "New Name" := NewCALHistoryObject."Object Name";
          "New Modified" := NewCALHistoryObject.Modified;
          "New Compiled" := NewCALHistoryObject.Compiled;
          "New Date" := NewCALHistoryObject."Object Date";
          "New Time" := NewCALHistoryObject."Object Time";
          "New Version List" := NewCALHistoryObject."Version List";

          INSERT(TRUE);

          FillLeftRight(Rec);
          MODIFY;

        UNTIL NewCALHistoryObject.NEXT = 0;

      IF NewCALHistoryLine.FINDSET THEN
        REPEAT
          TmpCALHistoryLine := NewCALHistoryLine;
          TmpCALHistoryLine.INSERT;
        UNTIL NewCALHistoryLine.NEXT = 0;

      ImportType := ImportType::Text;

      SetEditable;
    END;

    LOCAL PROCEDURE OnOpenForm@4();
    BEGIN
      IF FINDSET THEN BEGIN
        REPEAT
          CASE ImportType OF
            ImportType::Properties :
              "Import Action" := "Import Action"::"Import Properties";
            ImportType::Fob, ImportType::"Splitted FOB" :
              "Import Action" := "Import Action"::"Replace and Compile";
            ELSE
              "Import Action" := "Import Action"::Replace;
          END;
          MODIFY;
        UNTIL NEXT = 0;
        FINDFIRST;
      END;
    END;

    LOCAL PROCEDURE ImportObjects2@5();
    VAR
      TmpObjectImportLine@1000 : TEMPORARY Record 11102079;
      Object@1001 : Record 2000000001;
      Progressbar@1002 : Codeunit 11102044;
      ObjectMgt@1003 : Codeunit 11102046;
      SourceControl@1004 : Codeunit 11102050;
      FileHandler@1005 : Codeunit 11102097;
      FileNameMgt@1006 : Codeunit 11102107;
      FileName@1007 : Text;
      NoOfActions@1008 : Integer;
      ctCompiling@1009 : TextConst 'DEU="Compiling ";ENU="Compiling ";ESP="Compiling ";FRA="Compiling ";NLD="Compileren ";DEA="Compiling "';
      ctFileName@1010 : TextConst 'DEU=ImportObject.txt;ENU=ImportObject.txt;ESP=ImportObject.txt;FRA=ImportObject.txt;NLD=ImportObject.txt;DEA=ImportObject.txt';
      ctImportingObjects@1011 : TextConst 'DEU=Importing objects...;ENU=Importing objects...;ESP=Importing objects...;FRA=Importing objects...;NLD=Objecten importeren...;DEA=Importing objects...';
      ctObjectHeader@1012 : TextConst 'DEU=OBJECT %1 %2 %3;ENU=OBJECT %1 %2 %3;ESP=OBJECT %1 %2 %3;FRA=OBJECT %1 %2 %3;NLD=OBJECT %1 %2 %3;DEA=OBJECT %1 %2 %3';
      ctObjectsImported@1013 : TextConst 'DEU=Objects imported.;ENU=Objects imported.;ESP=Objects imported.;FRA=Objects imported.;NLD=Objecten zijn ge‹mporteerd.;DEA=Objects imported.';
    BEGIN
      IF ImportType = ImportType::Fob THEN BEGIN
        ObjectMgt.SetErrorHandling(FALSE);
        ObjectMgt.ImportObject(FobFileName);
      END ELSE BEGIN

        GetSelectedRecords(TmpObjectImportLine);

        WITH TmpObjectImportLine DO BEGIN

          IF FINDSET THEN
            REPEAT
              IF "Import Action" = "Import Action"::"Replace and Compile" THEN
                NoOfActions += 2
              ELSE
                NoOfActions += 1;
            UNTIL NEXT = 0;

          Progressbar.Open(ctImportingObjects, 1);
          Progressbar.BarSize := NoOfActions;

          IF FINDSET THEN
            REPEAT

              Progressbar.AddToBar(1);

              Object.Type := Type;
              Object.ID := "No.";
              Object.Name := "New Name";
              Progressbar.Text1Object := Object;

              CASE "Import Action" OF

                "Import Action"::Replace,
                "Import Action"::"Replace and Compile" :
                  CASE ImportType OF
                    ImportType::Binary :
                      NoSupportedError;

                    ImportType::Text :
                      BEGIN

                        TmpCALHistoryObject.RESET;
                        TmpCALHistoryObject.SETCURRENTKEY("Object Type", "Object No.");
                        TmpCALHistoryObject.SETRANGE("Object Type", Type);
                        TmpCALHistoryObject.SETRANGE("Object No.", "No.");
                        TmpCALHistoryObject.FINDFIRST;

                        TmpCALHistoryLine.SETRANGE("Entry No.", TmpCALHistoryObject."Entry No.");
                        TmpCALHistoryLine.FINDFIRST;
                        TmpCALHistoryLine.Code := STRSUBSTNO(ctObjectHeader, Type, "New Object No.", "New Name");
                        TmpCALHistoryLine.MODIFY;

                        FileName := FileHandler.TempDirectory + ctFileName;
                        SourceControl.ExportTextFile(FileName, TmpCALHistoryLine);
                        ObjectMgt.ImportObject(FileName);

                      END;

                    ImportType::"Splitted FOB" :
                      BEGIN
                        FileName := FileHandler.TempDirectory + FileNameMgt.ObjectFileName(Object, 'fob');
                        CALCFIELDS("BLOB Reference");
                        "BLOB Reference".EXPORT(FileName);
                        ObjectMgt.SetErrorHandling(FALSE);
                        ObjectMgt.ImportObject(FileName);
                      END;

                  END;

                "Import Action"::"Import Properties" :
                  IF Object.GET(Type, '', "New Object No.") THEN BEGIN
                    Object.Name := "New Name";
                    Object.Modified := "New Modified";
                    Object.Date := "New Date";
                    Object.Time := "New Time";
                    Object."Version List" := "New Version List";
                    ObjectMgt.UpdateObject(Object, FALSE);
                  END;

              END;

            UNTIL NEXT = 0;

          IF FINDSET THEN
            REPEAT
              Progressbar.AddToBar(1);
              Progressbar.Text1 := ctCompiling + FORMAT(Type) + ' ' + FORMAT("No.") + ' ' + "New Name";

              IF "Import Action" = "Import Action"::"Replace and Compile" THEN
                IF Object.GET(Type, '', "New Object No.") THEN
                  ObjectMgt.CompileObject(Object);

            UNTIL NEXT = 0;
        END;

        Progressbar.Close;

      END;

      MESSAGE(ctObjectsImported);
      CurrPage.CLOSE;
    END;

    LOCAL PROCEDURE SetImportActions@6(NewImportAction@1000 : Integer);
    VAR
      OriginalRec@1001 : Record 11102079;
      TmpObjectImportLine@1002 : TEMPORARY Record 11102079;
    BEGIN
      OriginalRec := Rec;

      GetSelectedRecords(TmpObjectImportLine);
      IF TmpObjectImportLine.FINDSET THEN
        REPEAT
          Rec := TmpObjectImportLine;
          "Import Action" := NewImportAction;
          MODIFY;
        UNTIL TmpObjectImportLine.NEXT = 0;

      Rec := OriginalRec;

      CurrPage.UPDATE(FALSE);
    END;

    LOCAL PROCEDURE GetCALHistoryObject@7(VAR TmpCALHistoryObject2@1000 : TEMPORARY Record 11102052);
    VAR
      CALHistoryObject@1001 : Record 11102052;
      TmpObjectImportLine@1002 : TEMPORARY Record 11102079;
    BEGIN
      GetSelectedRecords(TmpObjectImportLine);

      WITH TmpObjectImportLine DO
        IF FINDSET THEN
          REPEAT
            IF CALHistoryObject.TryGoToLastRecord(Type, "No.") THEN
              CALHistoryObject.AddToTempRecord(TmpCALHistoryObject2);
          UNTIL NEXT = 0;
    END;

    LOCAL PROCEDURE TestTextImport@8();
    VAR
      ctNoTextImport@1000 : TextConst 'DEU=Please import a text file.;ENU=Please import a text file.;ESP=Please import a text file.;FRA=Please import a text file.;NLD=Importeer eerst een tekstbestand.;DEA=Please import a text file.';
    BEGIN
      IF ImportType <> ImportType::Text THEN
        ERROR(ctNoTextImport);
    END;

    LOCAL PROCEDURE CheckCALHistory@9(VAR ObjectImportLine@1000 : Record 11102079);
    VAR
      Object@1001 : Record 2000000001;
      TmpObject@1002 : TEMPORARY Record 2000000001;
      CheckCALHistory@1003 : Codeunit 11102063;
    BEGIN
      IF ObjectImportLine.FINDSET THEN
        REPEAT
          IF Object.GET(ObjectImportLine.Type, '', ObjectImportLine."No.") THEN
            IF NOT TmpObject.GET(ObjectImportLine.Type, '', ObjectImportLine."No.") THEN BEGIN
              TmpObject := Object;
              TmpObject.INSERT;
            END;
        UNTIL ObjectImportLine.NEXT = 0;

      CheckCALHistory.RunWithObjectRange(TmpObject);
    END;

    LOCAL PROCEDURE FillLeftRight@10(VAR ObjectImportLine@1000 : Record 11102079);
    VAR
      VersionControl@1001 : Codeunit 11102040;
      SourceControl@1002 : Codeunit 11102050;
      ExistingObjectDateTime@1003 : DateTime;
      NewObjectDateTime@1004 : DateTime;
    BEGIN
      WITH ObjectImportLine DO BEGIN
        Different := FALSE;
        New := New::" ";

        IF ("Existing Name" <> "New Name") OR
           ("Existing Modified" <> "New Modified") OR
           (VersionControl.CleanUpVersionList("Existing Version List") <>
             VersionControl.CleanUpVersionList("New Version List")) OR
           ("Existing Date" <> "New Date") OR
           ("Existing Time" <> "New Time") OR
           ("Existing Compiled" <> "New Compiled")
        THEN BEGIN
          Different := TRUE;

          ExistingObjectDateTime := SourceControl.CreateDateTime2("Existing Date", "Existing Time");
          NewObjectDateTime := SourceControl.CreateDateTime2("New Date", "New Time");

          IF ExistingObjectDateTime < NewObjectDateTime THEN
            New := New::Newer;

          IF ExistingObjectDateTime > NewObjectDateTime THEN
            New := New::Older;

          IF "Existing Date" = "New Date" THEN
            IF ABS("Existing Time" - "New Time") < 1000 THEN
              New := New::" ";

        END;

        IF "Existing Name" = '' THEN
          New := New::New;

      END;
    END;

    LOCAL PROCEDURE ErrorIfProperties@11();
    VAR
      ctOnlyPropertieCanBeImportes@1000 : TextConst 'DEU=Only the properties of the objects can be imported.;ENU=Only the properties of the objects can be imported.;ESP=Only the properties of the objects can be imported.;FRA=Only the properties of the objects can be imported.;NLD=Alleen de eigenschappen van de objecten kunnen worden ge‹mporteerd.;DEA=Only the properties of the objects can be imported.';
    BEGIN
      IF ImportType = ImportType::Properties THEN
        ERROR(ctOnlyPropertieCanBeImportes);
    END;

    PROCEDURE SetImportedFileName@12(NewImportedFileName@1000 : Text);
    BEGIN
      ImportedFileName := NewImportedFileName;
      FobFileName := NewImportedFileName;
    END;

    LOCAL PROCEDURE ExportPropertiesFile@13(VAR TmpObjectImportLine@1000 : Record 11102079;VAR FileName@1001 : Text);
    VAR
      TmpObject2@1002 : TEMPORARY Record 2000000001;
      ImExportMgt@1003 : Codeunit 11102043;
      oFile@1004 : File;
      OutStr@1005 : OutStream;
    BEGIN
      oFile.CREATE(FileName);

      WITH TmpObjectImportLine DO
        IF FINDSET THEN
          REPEAT
            FillObject(TmpObject2);
            TmpObject2.INSERT;
          UNTIL NEXT = 0;

      oFile.CREATEOUTSTREAM(OutStr);
      ImExportMgt.FillOutstreamObp(OutStr, TmpObject2);

      oFile.CLOSE;
    END;

    LOCAL PROCEDURE ExportTextFile@14(VAR TmpObjectImportLine@1000 : Record 11102079;VAR FileName@1001 : Text);
    VAR
      Progressbar@1002 : Codeunit 11102044;
      SourceControl@1003 : Codeunit 11102050;
      oFile@1004 : File;
      LinesToExport@1005 : Integer;
      ctExportingObjects@1006 : TextConst 'DEU=Exporting objects...;ENU=Exporting objects...;ESP=Exporting objects...;FRA=Exporting objects...;NLD=Objecten exporteren...;DEA=Exporting objects...';
      ctObjectHeader@1007 : TextConst 'DEU=OBJECT %1 %2 %3;ENU=OBJECT %1 %2 %3;ESP=OBJECT %1 %2 %3;FRA=OBJECT %1 %2 %3;NLD=OBJECT %1 %2 %3;DEA=OBJECT %1 %2 %3';
    BEGIN
      oFile.TEXTMODE(TRUE);
      oFile.CREATE(FileName);

      WITH TmpObjectImportLine DO
        IF FINDSET THEN
          REPEAT

            TmpCALHistoryObject.RESET;
            TmpCALHistoryObject.SETCURRENTKEY("Object Type", "Object No.");
            TmpCALHistoryObject.SETRANGE("Object Type", Type);
            TmpCALHistoryObject.SETRANGE("Object No.", "No.");
            TmpCALHistoryObject.FINDFIRST;

            TmpCALHistoryLine.SETRANGE("Entry No.", TmpCALHistoryObject."Entry No.");
            LinesToExport += TmpCALHistoryLine.COUNT;
            TmpCALHistoryLine.FINDFIRST;
            TmpCALHistoryLine.Code := STRSUBSTNO(ctObjectHeader, Type, "New Object No.", "New Name");
            TmpCALHistoryLine.MODIFY;

          UNTIL NEXT = 0;

      TmpCALHistoryLine.RESET;

      Progressbar.Open(ctExportingObjects, 0);
      Progressbar.BarSize := LinesToExport;

      WITH TmpObjectImportLine DO
        IF FINDSET THEN
          REPEAT

            TmpCALHistoryObject.RESET;
            TmpCALHistoryObject.SETCURRENTKEY("Object Type", "Object No.");
            TmpCALHistoryObject.SETRANGE("Object Type", Type);
            TmpCALHistoryObject.SETRANGE("Object No.", "No.");
            TmpCALHistoryObject.FINDFIRST;

            TmpCALHistoryLine.SETRANGE("Entry No.", TmpCALHistoryObject."Entry No.");

            Progressbar.AddToBar(TmpCALHistoryLine.COUNT);

            SourceControl.AppendHistoryLinesToFile(oFile, TmpCALHistoryLine);

          UNTIL NEXT = 0;

      Progressbar.Close;

      oFile.CLOSE;
    END;

    LOCAL PROCEDURE ExportFob@15(VAR FileName@1000 : Text);
    VAR
      TmpObject2@1001 : TEMPORARY Record 2000000001;
      ImExportMgt@1002 : Codeunit 11102043;
      Progressbar@1003 : Codeunit 11102044;
      oFile@1004 : File;
      OutStr@1005 : OutStream;
      ctExportingObjects@1006 : TextConst 'DEU=Exporting objects...;ENU=Exporting objects...;ESP=Exporting objects...;FRA=Exporting objects...;NLD=Objecten exporteren...;DEA=Exporting objects...';
    BEGIN
      oFile.CREATE(FileName);

      Progressbar.Open(ctExportingObjects, 0);

      IF FINDSET THEN
        REPEAT
          FillObject(TmpObject2);
          TmpObject2.INSERT;
        UNTIL NEXT = 0;

      oFile.CREATEOUTSTREAM(OutStr);
      ImExportMgt.FillOutstreamFob(OutStr, TmpObject2, Progressbar);

      Progressbar.Close;
    END;

    LOCAL PROCEDURE ExportSplitFob@21();
    VAR
      TmpObjectImportLine@1000 : TEMPORARY Record 11102079;
      Object@1001 : Record 2000000001;
      Progressbar@1002 : Codeunit 11102044;
      CommonDialog@1003 : Codeunit 11102059;
      FileHandler@1004 : Codeunit 11102097;
      FileNameMgt@1005 : Codeunit 11102107;
      ClientDirectoryName@1006 : Text;
      FileName@1007 : Text;
      ServerDirectoryName@1008 : Text;
      ctExportingObjects@1009 : TextConst 'DEU=Exporting objects...;ENU=Exporting objects...;ESP=Exporting objects...;FRA=Exporting objects...;NLD=Objecten exporteren...;DEA=Exporting objects...';
    BEGIN
      CommonDialog.SelectDirectory(ClientDirectoryName);
      IF ClientDirectoryName <> '' THEN BEGIN

        FileHandler.CheckCreateClientDirectory(ClientDirectoryName);
        ServerDirectoryName := FileHandler.CreateServerDirectoryForDownload(ClientDirectoryName);

        GetSelectedRecords(TmpObjectImportLine);

        Progressbar.Open(ctExportingObjects, 0);
        Progressbar.BarSize := TmpObjectImportLine.COUNT;

        IF TmpObjectImportLine.FINDSET THEN
          REPEAT
            TmpObjectImportLine.FillObject(Object);
            FileName := FileNameMgt.ObjectFileName(Object, 'fob');
            TmpObjectImportLine."BLOB Reference".EXPORT(ServerDirectoryName + FileName);

          UNTIL TmpObjectImportLine.NEXT = 0;

        Progressbar.Close;

        FileHandler.DownloadDirectoryToClient(ServerDirectoryName, ClientDirectoryName);

      END;
    END;

    LOCAL PROCEDURE ResetLines@16();
    BEGIN
      RESET;
      DELETEALL;

      TmpCALHistoryObject.RESET;
      TmpCALHistoryObject.DELETEALL;

      TmpCALHistoryLine.RESET;
      TmpCALHistoryLine.DELETEALL;
    END;

    LOCAL PROCEDURE GetSelectedRecords@17(VAR ObjectImportLine@1000 : TEMPORARY Record 11102079);
    VAR
      OriginalRec@1001 : Record 11102079;
    BEGIN
      OriginalRec := Rec;
      OriginalRec.SETVIEW(GETVIEW);

      CurrPage.SETSELECTIONFILTER(Rec);
      IF COUNT = 1 THEN BEGIN
        RESET;
        SETVIEW(OriginalRec.GETVIEW);
      END;

      IF FINDSET THEN
        REPEAT
          CALCFIELDS("BLOB Reference");
          ObjectImportLine := Rec;
          ObjectImportLine."BLOB Reference" := "BLOB Reference";
          ObjectImportLine.INSERT;
        UNTIL NEXT = 0;

      RESET;
      Rec := OriginalRec;
      SETVIEW(OriginalRec.GETVIEW);
    END;

    LOCAL PROCEDURE NoSupportedError@18();
    VAR
      ctNotSupported@1000 : TextConst 'DEU=Not supported.;ENU=Not supported.;ESP=Not supported.;FRA=Not supported.;NLD=Niet ondersteund.;DEA=Not supported.';
    BEGIN
      ERROR(ctNotSupported);
    END;

    LOCAL PROCEDURE SetEditable@19();
    BEGIN
      ActionEditable := ImportType IN [ImportType::Text, ImportType::Properties, ImportType::"Splitted FOB"];
      ObjectEditable := ImportType IN [ImportType::Text, ImportType::Properties];
      CanSetSelection := ImportType <> ImportType::Fob;
      TextOptionsEditable := ImportType = ImportType::Text;
    END;

    BEGIN
    END.
  }
}

