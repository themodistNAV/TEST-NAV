OBJECT Table 9021642 Internet Customers
{
  OBJECT-PROPERTIES
  {
    Date=13/07/16;
    Time=[ 1:50:03 PM];
    Version List=EC2016.6;
  }
  PROPERTIES
  {
    DataCaptionFields=Name;
    CaptionML=[ENU=Internet Customers;
               ENG=Internet Customers];
    LookupPageID=Page9021719;
    DrillDownPageID=Page9021719;
  }
  FIELDS
  {
    { 1   ;   ;Customer No.        ;Code20        ;TableRelation=Customer;
                                                   OnValidate=BEGIN
                                                                {
                                                                //DOC EC2013.3.40 MQ 06/01/2013 - GW130106 taken out cos identical code is in UpdateToCustomerYesNo
                                                                IF (xRec."Customer No." <> '') AND (xRec."Customer No." <> "Customer No.") THEN BEGIN
                                                                  CALCFIELDS("B2B Customer");
                                                                  IF "B2B Customer" THEN
                                                                    ERROR(Text75008,FIELDCAPTION("Customer No."));
                                                                  IF Customer.GET(xRec."Customer No.") THEN BEGIN
                                                                    Customer."User GUID" := '';
                                                                    Customer.VALIDATE("Is An Internet Customer",FALSE);
                                                                    Customer.MODIFY;
                                                                  END;
                                                                END;
                                                                }

                                                                UpdateToCustomerYesNo;

                                                                {
                                                                //DOC EC2013.3.40 MQ 06/01/2013 - GW130106 taken out cos identical code is in UpdateToCustomerYesNo
                                                                IF "Customer No." <> '' THEN BEGIN
                                                                  Customer.GET("Customer No.");
                                                                  TESTFIELD("Label Code",Customer."Label Code");
                                                                END;
                                                                }
                                                              END;

                                                   CaptionML=[DAN=Kundenummer;
                                                              DEU=Kunden Nr.;
                                                              ENU=Customer No.;
                                                              ESP=No. Cliente;
                                                              SVE=Kundnr;
                                                              ENG=Customer No.];
                                                   Description=EC2009.2.3 Editable No;
                                                   Editable=No }
    { 2   ;   ;Name                ;Text50        ;CaptionML=[DAN=Navn;
                                                              DEU=Name;
                                                              ENU=Name;
                                                              ESP=Nombre;
                                                              SVE=Namn;
                                                              ENG=Name];
                                                   Description=EC2016.1.1 changed from 30 to 50 }
    { 5   ;   ;Address             ;Text50        ;CaptionML=[DAN=Adresse;
                                                              DEU=Adresse;
                                                              ENU=Address;
                                                              ESP=Direcci¢n;
                                                              SVE=Adress;
                                                              ENG=Address];
                                                   Description=EC2016.1.1 changed from 30 to 50 }
    { 6   ;   ;Address 2           ;Text50        ;CaptionML=[DAN=Adresse 2;
                                                              DEU=Adresse 2;
                                                              ENU=Address 2;
                                                              ESP=Direcci¢n 2;
                                                              SVE=Adress 2;
                                                              ENG=Address 2];
                                                   Description=EC2016.1.1 changed from 30 to 50 }
    { 7   ;   ;City                ;Text30        ;CaptionML=[DAN=By;
                                                              DEU=Stadt;
                                                              ENU=City;
                                                              ESP=Provincia;
                                                              SVE=Ort;
                                                              ENG=City] }
    { 8   ;   ;Contact             ;Text50        ;CaptionML=[DAN=Attention;
                                                              DEU=Kontakt;
                                                              ENU=Contact;
                                                              ESP=Contacto;
                                                              SVE=Kontaktperson;
                                                              ENG=Contact];
                                                   Description=EC2016.1.1 changed from 30 to 50 }
    { 9   ;   ;Phone No.           ;Text80        ;CaptionML=[DAN=Telefon;
                                                              DEU=Telfon Nr.;
                                                              ENU=Phone No.;
                                                              ESP=No. TelÇfono;
                                                              SVE=Telefonnr;
                                                              ENG=Phone No.];
                                                   Description=EC2016.1.1 changed from 30 to 80 }
    { 35  ;   ;Country Code        ;Code10        ;TableRelation=Country/Region;
                                                   CaptionML=[DAN=Landekode;
                                                              DEU=LÑndercode;
                                                              ENU=Country Code;
                                                              ESP=C¢digo Pa°s;
                                                              SVE=Landkod;
                                                              ENG=Country Code] }
    { 54  ;   ;Last Date Modified  ;Date          ;CaptionML=[DAN=Rettet den;
                                                              DEU=Letztes Datum der VerÑnderung;
                                                              ENU=Last Date Modified;
                                                              ESP=Fecha Èltima Modificaci¢n;
                                                              SVE=Uppdateringsdatum;
                                                              ENG=Last Date Modified] }
    { 91  ;   ;Post Code           ;Code20        ;TableRelation="Post Code";
                                                   CaptionML=[DAN=Postnr.;
                                                              DEU=Versandcode;
                                                              ENU=Post Code;
                                                              ESP=C¢digo postal;
                                                              SVE=Postnr;
                                                              ENG=Post Code] }
    { 92  ;   ;County              ;Text30        ;CaptionML=[DAN=Amt;
                                                              DEU=Land;
                                                              ENU=County;
                                                              ESP=Pa°s;
                                                              SVE=Land;
                                                              ENG=County];
                                                   Description=EC2016.1.1 added ENG Caption County }
    { 102 ;   ;E-Mail              ;Text80        ;CaptionML=[DAN=E-mail;
                                                              DEU=E-Mail;
                                                              ENU=E-Mail;
                                                              ESP=E-Mail;
                                                              SVE=E-post;
                                                              ENG=E-Mail] }
    { 200 ;   ;Not Active          ;Boolean       ;CaptionML=[ENU=Not Active;
                                                              ENG=Not Active];
                                                   Description=GW add 130814 }
    { 38700;  ;No.                 ;Text38        ;CaptionML=[DAN=Nummer;
                                                              DEU=Nr.;
                                                              ENU=No.;
                                                              ESP=No.;
                                                              SVE=Nr;
                                                              ENG=No.] }
    { 38701;  ;Login               ;Code80        ;OnValidate=VAR
                                                                InternetCustomer@1000000000 : Record 9021642;
                                                              BEGIN
                                                              END;

                                                   CaptionML=[DAN=Login;
                                                              DEU=Anmeldung;
                                                              ENU=Login;
                                                              ESP=Usuario;
                                                              SVE=Inloggning;
                                                              ENG=Login];
                                                   Description=EC2016.1.1 changed from Text 20 to Code 80 }
    { 38702;  ;Password            ;Text40        ;CaptionML=[DAN=Kodeord;
                                                              DEU=Passwort;
                                                              ENU=Password;
                                                              ESP=Contrase§a;
                                                              SVE=Lîsenord;
                                                              ENG=Password];
                                                   NotBlank=Yes;
                                                   Description=EC2016.1.1 changed from Text 20 to Text 40 }
    { 38703;  ;Created             ;Date          ;CaptionML=[DAN=Oprettet;
                                                              DEU=Erzeugt;
                                                              ENU=Created;
                                                              ESP=Creado;
                                                              SVE=Skapad;
                                                              ENG=Created] }
    { 38704;  ;B2B Customer        ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Internet Login" WHERE (No.=FIELD(No.)));
                                                   CaptionML=[DAN=B2B Kunde;
                                                              DEU=B2B Kunde;
                                                              ENU=B2B Customer;
                                                              ESP="Cliente B2B ";
                                                              SVE=B2B Kund;
                                                              ENG=B2B Customer];
                                                   Description=flowfield;
                                                   Editable=No }
    { 38705;  ;Currency Code       ;Code10        ;TableRelation=Currency;
                                                   CaptionML=[DAN=Valuta kode;
                                                              DEU=WÑhrungscode;
                                                              ENU=Currency Code;
                                                              ESP="C¢digo Divisa ";
                                                              SVE=Valutakod;
                                                              ENG=Currency Code] }
    { 38706;  ;Secondary Currency Code;Code10     ;TableRelation=Currency;
                                                   CaptionML=[DAN=Alternativ Valuta kode;
                                                              DEU=Zweiter WÑhrungscode;
                                                              ENU=Secondary Currency Code;
                                                              ESP=C¢digo Divisa Secundaria;
                                                              SVE=Andra valutakoden;
                                                              ENG=Secondary Currency Code] }
    { 38707;  ;State               ;Text30        ;CaptionML=[DAN=Stat;
                                                              DEU=Status;
                                                              ENU=State;
                                                              ESP=Provincia;
                                                              SVE=State Stat;
                                                              ENG=State] }
    { 75000;  ;Label Code          ;Code10        ;TableRelation=Label;
                                                   OnValidate=BEGIN
                                                                IF "Label Code" <> '' THEN BEGIN
                                                                  LabelRec.GET("Label Code");
                                                                  IF LabelRec."Used-in Company" <> COMPANYNAME THEN
                                                                    ERROR(Text75000,"Label Code",COMPANYNAME);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Label Code;
                                                              ENG=Label Code];
                                                   Description=EC2016.1.1 }
    { 75014;  ;Source Code User Created;Code20    ;TableRelation="Marketing Source Code";
                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Source Code User Created;
                                                              ENG=Source Code User Created];
                                                   Description=EC2016.1.1 }
    { 75015;  ;Source Code Last Tracked;Code20    ;TableRelation="Marketing Source Code";
                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Source Code Last Tracked;
                                                              ENG=Source Code Last Tracked];
                                                   Description=EC2016.1.1 }
    { 75016;  ;Source Code Last Tracked DateT;DateTime;
                                                   CaptionML=[ENU=Source Code Last Tracked DateT;
                                                              ENG=Source Code Last Tracked DateT];
                                                   Description=EC2016.1.1 }
    { 75021;  ;Contact No.         ;Code20        ;TableRelation=Contact;
                                                   OnValidate=VAR
                                                                TxtLabelCode@1000000000 : TextConst 'ENU=Label Code;ENG=Label Code';
                                                                TxtInternetCustomer@1000000001 : TextConst 'ENU=Internet Customer;ENG=Internet Customer';
                                                                TxtContactNo@1000000002 : TextConst 'ENU=Contact No.;ENG=Contact No.';
                                                                TxtInternetB2BCustomer@1000000003 : TextConst 'ENU=Internet B2B Customer;ENG=Internet B2B Customer';
                                                                TxtContact@1000000004 : TextConst 'ENU=Contact;ENG=Contact';
                                                              BEGIN
                                                                CALCFIELDS("B2B Customer");
                                                                IF "B2B Customer" THEN BEGIN
                                                                  InternetCustB2BRec.GET("No.");
                                                                  IF InternetCustB2BRec."Label Code" <> "Label Code" THEN
                                                                    ERROR(Text75006,TxtLabelCode,TxtInternetCustomer,"Label Code",
                                                                          TxtInternetB2BCustomer,InternetCustB2BRec."Label Code");
                                                                  IF InternetCustB2BRec."Contact No." <> "Contact No." THEN
                                                                    ERROR(Text75006,TxtContactNo,TxtInternetCustomer,"Contact No.",
                                                                          TxtInternetB2BCustomer,InternetCustB2BRec."Contact No.");
                                                                  ContactRec.GET("Contact No.");
                                                                  IF (ContactRec."Label Code" <> "Label Code") AND (ContactRec."Label Code" <> '') THEN
                                                                    ERROR(Text75006,TxtLabelCode,TxtInternetCustomer,"Label Code",
                                                                          TxtContact,ContactRec."Label Code");
                                                                  "Customer No." := InternetCustB2BRec."Customer No.";
                                                                END ELSE BEGIN
                                                                  //DOC EC2013.4.00 -
                                                                  IF "B2B Registration" THEN BEGIN
                                                                    ContBusRelRec.RESET;
                                                                    ContBusRelRec.SETRANGE("Contact No.","Contact No.");
                                                                    ContBusRelRec.SETRANGE("Link to Table",
                                                                                       ContBusRelRec."Link to Table"::Customer);
                                                                    IF ContBusRelRec.FINDFIRST THEN BEGIN
                                                                      Customer.GET(ContBusRelRec."No.");
                                                                      Customer.TESTFIELD("Label Code");
                                                                      Customer.TESTFIELD("Is An Internet Customer");
                                                                      Customer.TESTFIELD("Is a B2B Internet Customer");
                                                                      InternetCustB2BRec.INIT;
                                                                      InternetCustB2BRec."No." := "No.";
                                                                      InternetCustB2BRec."Customer No." := Customer."No.";
                                                                      InternetCustB2BRec.Contact := Contact;
                                                                      InternetCustB2BRec."E-Mail" := "E-Mail";
                                                                      InternetCustB2BRec.Login := Login;
                                                                      InternetCustB2BRec."Code Login" := Login;
                                                                      InternetCustB2BRec.Password := Password;
                                                                      //DOC EC2013.4.64 InternetCustB2BRec."Password Version" := Password; //DOC EC2013.3.61
                                                                      InternetCustB2BRec."Password Version" := COPYSTR(Password,1,38); //DOC EC2013.4.64
                                                                      InternetCustB2BRec."Label Code" := "Label Code";
                                                                      InternetCustB2BRec.Enable := TRUE;
                                                                      InternetCustB2BRec.DateTimeInsertedModified := CURRENTDATETIME;
                                                                      InternetCustB2BRec."Inserted Modified By" := 'B2BREG';
                                                                      InternetCustB2BRec.INSERT(TRUE);
                                                                      "Contact No." := InternetCustB2BRec."Contact No.";
                                                                      "Customer No." := Customer."No.";
                                                                    END ELSE
                                                                      ERROR(Text023);

                                                                  END ELSE BEGIN
                                                                  //DOC EC2013.4.00 +
                                                                    //Separate code cos sometimes xRec is not reliable
                                                                    IF xRec."Contact No." <> '' THEN BEGIN
                                                                      ContactRec.GET(xRec."Contact No.");
                                                                      ContactRec.VALIDATE("Is An Internet Customer",FALSE);
                                                                      ContactRec."User GuID" := '';
                                                                      ContactRec.MODIFY;
                                                                      LocalSegmentLineRec1.RESET;
                                                                      LocalSegmentLineRec1.SETRANGE("Contact No.",xRec."Contact No.");
                                                                      LocalSegmentLineRec1.SETCURRENTKEY("Contact No.");
                                                                      IF LocalSegmentLineRec1.FIND('-') THEN
                                                                      REPEAT
                                                                        LocalSegmentLineRec2 := LocalSegmentLineRec1;
                                                                        LocalSegmentLineRec2."Company User GuID" := '';
                                                                        LocalSegmentLineRec2.MODIFY;
                                                                      UNTIL LocalSegmentLineRec1.NEXT = 0;
                                                                      ContBusRelRec.RESET;
                                                                      ContBusRelRec.SETRANGE("Contact No.",xRec."Contact No.");
                                                                      ContBusRelRec.SETRANGE("Link to Table",
                                                                                         ContBusRelRec."Link to Table"::Customer);
                                                                      IF ContBusRelRec.FINDFIRST THEN BEGIN
                                                                        Customer.GET(ContBusRelRec."No.");
                                                                        Customer.VALIDATE("Is An Internet Customer",FALSE);
                                                                        Customer."User GUID" := '';
                                                                        Customer.MODIFY;
                                                                      END;
                                                                    END;

                                                                    //not sure we need this as I think it is being done already
                                                                    IF "Contact No." <> '' THEN BEGIN
                                                                      ContactRec.GET("Contact No.");
                                                                      ContactRec.VALIDATE("Is An Internet Customer",TRUE);
                                                                      ContactRec."User GuID" := "No.";
                                                                      ContactRec.MODIFY;
                                                                      LocalSegmentLineRec1.RESET;
                                                                      LocalSegmentLineRec1.SETRANGE("Contact No.","Contact No.");
                                                                      LocalSegmentLineRec1.SETCURRENTKEY("Contact No.");
                                                                      IF LocalSegmentLineRec1.FIND('-') THEN
                                                                      REPEAT
                                                                        LocalSegmentLineRec2 := LocalSegmentLineRec1;
                                                                        LocalSegmentLineRec2."Company User GuID" := "No.";
                                                                        LocalSegmentLineRec2.MODIFY;
                                                                      UNTIL LocalSegmentLineRec1.NEXT = 0;
                                                                      ContBusRelRec.RESET;
                                                                      ContBusRelRec.SETRANGE("Contact No.","Contact No.");
                                                                      ContBusRelRec.SETRANGE("Link to Table",
                                                                                         ContBusRelRec."Link to Table"::Customer);
                                                                      IF ContBusRelRec.FINDFIRST THEN BEGIN
                                                                        Customer.GET(ContBusRelRec."No.");
                                                                        Customer.VALIDATE("Is An Internet Customer",TRUE);
                                                                        Customer."User GUID" := "No.";
                                                                        Customer.MODIFY;
                                                                      END;
                                                                    END;

                                                                    IF (CurrFieldNo <> 0) AND (xRec."Contact No." <> "Contact No.") THEN BEGIN
                                                                      IF NOT CONFIRM (Text000,FALSE,FIELDCAPTION("Contact No.")) THEN
                                                                        ERROR('')
                                                                      ELSE
                                                                        UpdateToContactYesNo;
                                                                    END;
                                                                    IF "Contact No." = '' THEN
                                                                      IF "Customer No." <> '' THEN //DOC EC2013.4.5
                                                                        VALIDATE("Customer No.",'')
                                                                    ELSE BEGIN
                                                                      ContBusRelRec.RESET;
                                                                      ContBusRelRec.SETRANGE("Contact No.","Contact No.");
                                                                      ContBusRelRec.SETRANGE("Link to Table",
                                                                                         ContBusRelRec."Link to Table"::Customer);
                                                                      IF ContBusRelRec.FINDFIRST THEN BEGIN
                                                                        VALIDATE("Customer No.",ContBusRelRec."No.");
                                                                      END;
                                                                    END;
                                                                  END; //DOC EC2013.4.00
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Contact No.;
                                                              ENG=Contact No.];
                                                   Description=EC2009.2.3 Editable No;
                                                   Editable=No }
    { 75029;  ;Last DateTime Modified;DateTime    ;CaptionML=[ENU=Last DateTime Modified;
                                                              ENG=Last DateTime Modified];
                                                   Description=GW add 110131 }
    { 75030;  ;Last DateTime Processed;DateTime   ;CaptionML=[ENU=Last DateTime Processed;
                                                              ENG=Last DateTime Processed];
                                                   Description=GW add 110131 }
    { 75036;  ;Salesperson Code    ;Code10        ;TableRelation=Salesperson/Purchaser;
                                                   CaptionML=[ENU=Salesperson Code;
                                                              ENG=Salesperson Code];
                                                   Description=EC2016.1.1 }
    { 75040;  ;B2B Registration    ;Boolean       ;CaptionML=[ENU=B2B Registration;
                                                              ENG=B2B Registration];
                                                   Description=EC2013.3.20 GW add 121031 }
    { 75069;  ;Date First Ordered  ;Date          ;CaptionML=[ENU=Date First Ordered;
                                                              ENG=Date First Ordered] }
    { 75070;  ;Date Last Ordered   ;Date          ;CaptionML=[ENU=Date Last Ordered;
                                                              ENG=Date Last Ordered] }
  }
  KEYS
  {
    {    ;No.                                     ;Clustered=Yes }
    {    ;Customer No.                             }
    {    ;Login                                    }
    {    ;Name                                     }
    {    ;Country Code                             }
    {    ;Contact No.                              }
    {    ;Last DateTime Modified                   }
    {    ;Created                                  }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      Customer@1000000000 : Record 18;
      Customer2@1000000013 : Record 18;
      InternetCustomer@1000000001 : Record 9021642;
      InternetSetup@1000000002 : Record 9021609;
      InternetCustB2BRec@1000000003 : Record 9021643;
      RMSetup@1000000028 : Record 5079;
      Text000@1000000006 : TextConst 'DAN=Vil du ëndre %1?;DEU=WÅnschen Sie zu verÑndern %1?;ENU=Do you want to change %1?;ESP=Desea cambiar %1?;SVE=Vill du Ñndra %1?;ENG=Do you want to change %1?';
      Text001@1000000007 : TextConst 'DAN=Systemet har fundet en eller flere %1 som matcher %2.\;DEU=Das System fand eine oder mehrere %1 passend zu %2.\;ENU=The system found one or more %1s matching the %2.;ESP=El sistema ha encontrado  %1 coincidencias con %2.\;SVE=Systemet hittade en eller flera %1 som passar mot %2.\;ENG=The system found one or more %1s matching the %2.';
      Text002@1000000008 : TextConst 'DAN=Vil du tilknytte en af dem i stedet for at oprette en ny?;DEU=WÅnschen Sie eines dieser festzulegen anstatt ein neues %1 anzulegen?;ENU=" Do you want to assign one of those instead of creating a new %1?";ESP=®Desea asignar uno de estos en lugar de crear un nuevo %1?;SVE=Vill du tilldela en av dess istÑllet fîr att skapa en ny %1?;ENG=" Do you want to assign one of those instead of creating a new %1?"';
      Text003@1000000009 : TextConst 'DAN=Der blev ikke knyttet nogen %1 til %2.;DEU=Nein %1 war festgelegt fÅr %2.;ENU=No %1 was assigned to the %2.;ESP=No %1 fue asignado a %2.;SVE=Ingen %1 blev tilldelad till %2.;ENG=No %1 was assigned to the %2.';
      Text004@1000000010 : TextConst 'DAN=ùnsker du at opdatere information pÜ %3 %2 fra denne %1?;DEU=WÅnschen Sie zu aktualisieren die Informationen fÅr %3 %2 von %1?;ENU=Do you want to update information on %3 %2 from this %1?;ESP=Desea actualizar informaci¢n en %3 %2 desde %1?;SVE=Vill du uppdatera information om %3 %2 frÜn denna %1?;ENG=Do you want to update information on %3 %2 from this %1?';
      Text005@1000000011 : TextConst 'DAN=Ingen %1 er knyttet til denne %2.;DEU=Nein %1 ist verbunden mit %2.;ENU=No %1 is associated with this %2.;ESP=No %1 est† asociado con este %2.;SVE=Ingen %1 Ñr associerad med denna %2.;ENG=No %1 is associated with this %2.';
      Text006@1000000012 : TextConst 'DAN=Denne funktion vil oprette et nyt B2B Login til denne internet kunde\ùnsker du at fortsëtte?;DEU=Sie sind dabei eine B2B-Anmeldung fÅr diesen Internet-Kunden anzulegen\Mîchten Sie fortfahren?;ENU=You are about to create an B2B Login for this Internet Customer\Do you want to continue?;ESP=Est† a punto de crear un Usuario B2B para este Cliente\®Desea continuar?;SVE=Du hÜller pÜ att skapa en B2 Login fîr denna Internetkund\Vill du fortsÑtta?;ENG=You are about to create an B2B Login for this Internet Customer\Do you want to continue?';
      LabelRec@1040001 : Record 9021618;
      Text75000@1040002 : TextConst 'ENU=The label %1 is not associated with the company %2. (75000);ENG=The label %1 is not associated with the company %2. (75000)';
      ContactRec@1040007 : Record 5050;
      Text75001@1040004 : TextConst 'ENU="You should not need to create a contact where B2B Customer in TRUE. (75001) ";ENG="You should not need to create a contact where B2B Customer in TRUE. (75001) "';
      ContactRec2@1040009 : Record 5050;
      ContBusRelRec@1040008 : Record 5054;
      CountryRegionRec@1040010 : Record 9;
      CustTemplate@1040011 : Record 5105;
      Text75002@1040012 : TextConst 'ENU=Could not find customer created from contact. (Internet Customer, CreateCustomer2). (75002);ENG=Could not find customer created from contact. (Internet Customer, CreateCustomer2). (75002)';
      Text75003@1040013 : TextConst 'ENU=The Internet Customer needs to be matched to a Contact before you can match it to a Customer. (75003);ENG=The Internet Customer needs to be matched to a Contact before you can match it to a Customer. (75003)';
      TempContRec@1040014 : TEMPORARY Record 5050;
      TempCustRec@1040015 : TEMPORARY Record 18;
      Text75004@1000000019 : TextConst 'ENU=Function: UpdatetoCustomer - Customer No. is %1 but cannot find customer. (75004);ENG=Function: UpdatetoCustomer - Customer No. is %1 but cannot find customer. (75004)';
      Text75005@1000000020 : TextConst 'ENU=You cannot update Customer %1 from Internet Customer %2 as the Internet Customer is a B2B Customer. (75005);ENG=You cannot update Customer %1 from Internet Customer %2 as the Internet Customer is a B2B Customer. (75005)';
      Text75006@1000000014 : TextConst 'ENU=Error.. The %1 on the %2 is %3 while the %1 on the %4 is %5. (75006);ENG=Error.. The %1 on the %2 is %3 while the %1 on the %4 is %5. (75006)';
      Text75007@1000000016 : TextConst 'ENU=Error..Internet Customer %1 is associated with Country %2 even though it cannot be used online. (75007);ENG=Error..Internet Customer %1 is associated with Country %2 even though it cannot be used online. (75007)';
      Text75008@1000000015 : TextConst 'ENU=This is a B2B customer so you cannot blank the %1.  (75008);ENG=This is a B2B customer so you cannot blank the %1.  (75008)';
      DefaultDimen@1000000017 : Record 352;
      DefaultDimen2@1000000018 : Record 352;
      Text75009@1000000021 : TextConst 'ENU=You cannot update Contact %1 from Internet Customer %2 as the Internet Customer is a B2B Customer. (75009);ENG=You cannot update Contact %1 from Internet Customer %2 as the Internet Customer is a B2B Customer. (75009)';
      Text75010@1000000022 : TextConst 'ENU=Function: UpdatetoContact - Contact No. is %1 but cannot find contact. (75010);ENG=Function: UpdatetoContact - Contact No. is %1 but cannot find contact. (75010)';
      LocalSegmentLineRec1@1000000024 : Record 5077;
      LocalSegmentLineRec2@1000000023 : Record 5077;
      Text75011@1000000025 : TextConst 'ENU=Customer No. is not Internet B2B Customer No. on Internet Customer %1 in CreateContact. (75011);ENG=Customer No. is not Internet B2B Customer No. on Internet Customer %1 in CreateContact. (75011)';
      Text75012@1190000005 : TextConst 'ENU=Creating or Linking to New Customer\\Contact %1 is not associated with a customer.  You can either link it to an existing customer or create a new customer.\\Answering Yes will create a new customer, No will allow you to link to an existing customer.;ENG=Creating or Linking to New Customer\\Contact %1 is not associated with a customer.  You can either link it to an existing customer or create a new customer.\\Answering Yes will create a new customer, No will allow you to link to an existing customer.';
      Text75013@1190000006 : TextConst 'ENU=There are multiple Contacts in CreateContact for the Internet Customer %1 (75013);ENG=There are multiple Contacts in CreateContact for the Internet Customer %1 (75013)';
      NoSeriesMgt@1000000005 : Codeunit 396;
      InternetShopMgt@1000000004 : Codeunit 9021610;
      UpdateContFromCust@1000000030 : Codeunit 5056;
      IssueText@1000000026 : Text[250];
      Text75014@1000000031 : TextConst 'ENU=Attention Only......... Created B2B Customer No. %1 as a result of request from web. (75014);ENG=Attention Only......... Created B2B Customer No. %1 as a result of request from web. (75014)';
      Text022@1000000027 : TextConst 'ENU=B2B Registration is ticked but cannot create an Internet B2B Login as one already exists with this email address.  You cannot use this method to create another B2B Login with the same email address. [The User record on the web must be first deleted and this Internet Customer and then use the B2B Login form in NAV] (22);ENG=B2B Registration is ticked but cannot create an Internet B2B Login as one already exists with this email address.  You cannot use this method to create another B2B Login with the same email address. [The User record on the web must be first deleted and this Internet Customer and then use the B2B Login form in NAV] (22)';
      Text023@1000000029 : TextConst 'ENU=The contact must be linked to a customer for this to work. (023);ENG=The contact must be linked to a customer for this to work. (023)';

    PROCEDURE CreateCustomer@2();
    VAR
      TextL000@1190000005 : TextConst 'ENU=No link made.;ENG=No link made.';
      TextL001@1190000009 : TextConst 'ENU=Error.... Customer No. must be blank to run this.  Choose Clear Customer No. first.  In CreateCustomer (TextL001);ENG=Error.... Customer No. must be blank to run this.  Choose Clear Customer No. first.  In CreateCustomer (TextL001)';
      TextL002@1190000007 : TextConst 'ENU=Contact No. %1 is not linked to a Customer.  Please go to contact and either create a new customer or link to an existing customer.  InCreateCustomer (TextL003);ENG=Contact No. %1 is not linked to a Customer.  Please go to contact and either create a new customer or link to an existing customer.  InCreateCustomer (TextL003)';
      TxtNoGuiAllowed@1000000000 : TextConst 'ENU=Internet Customer function CreateCustomer is not designed to work on non GuiAllowed mode.;ENG=Internet Customer function CreateCustomer is not designed to work on non GuiAllowed mode.';
    BEGIN
      //Call from Internet Customer Card/List
      CALCFIELDS("B2B Customer");
      TESTFIELD("B2B Customer",FALSE);

      IF "Contact No." = '' THEN
        ERROR(Text75003);

      ContactRec.GET("Contact No.");
      IF ContactRec."Is An Internet Customer" = FALSE THEN BEGIN
        ContactRec."Is An Internet Customer" := TRUE;
        ContactRec.MODIFY(TRUE);
        COMMIT;
      END;
      IF ContactRec."User GuID" = '' THEN
        ERROR(TextL002,ContactRec.FIELDCAPTION("User GuID"));
      IF ContactRec."Label Code" = '' THEN
        ERROR(TextL002,ContactRec.FIELDCAPTION("Label Code"));
      IF "Customer No." <> '' THEN
        ERROR(TextL001);

      Customer.RESET;
      ContBusRelRec.RESET;
      ContBusRelRec.SETRANGE("Contact No.","Contact No.");
      ContBusRelRec.SETRANGE("Link to Table",ContBusRelRec."Link to Table"::Customer);
      IF ContBusRelRec.FINDFIRST THEN BEGIN
        VALIDATE("Customer No.",ContBusRelRec."No.");
        MODIFY;
      END ELSE BEGIN
        //DOC EC2009.2.74 -
        InternetSetup.GET;
        IF InternetSetup."Use Internet Customer" = InternetSetup."Use Internet Customer"::Always THEN BEGIN
          InternetSetup.TESTFIELD("Internet Customer");
          InternetSetup.TESTFIELD("Internet Contact Company No.");
          VALIDATE("Customer No.",InternetSetup."Internet Customer");
          MODIFY;
          ContactRec.Type := ContactRec.Type::Person;
          ContactRec."Lookup Contact No." := ContactRec."No.";
          ContactRec."Company No." := InternetSetup."Internet Contact Company No.";
          ContactRec.MODIFY;
        END ELSE BEGIN
        //DOC EC2009.2.74 +
          IF NOT GUIALLOWED THEN
            ERROR(TxtNoGuiAllowed);
          IF CONFIRM(Text75012,TRUE,"Contact No.") THEN BEGIN
            //Create New Customer
            ContactRec.GET("Contact No.");
            CountryRegionRec.GET("Country Code");
            CountryRegionRec.TESTFIELD("B2C Customer Template");
            ContactRec.SetHideValidationDialog(TRUE);
            ContactRec.CreateCustomer(CountryRegionRec."B2C Customer Template");
          END ELSE BEGIN
            //Link to an Existing Customer
            ContactRec.GET("Contact No.");
            ContactRec.CreateCustomerLink;
          END;
        END;  //DOC EC2009.2.74
      END;
    END;

    PROCEDURE UpdateToCustomer@8();
    BEGIN
      IF "Customer No." = '' THEN
        EXIT;

      CALCFIELDS("B2B Customer");
      IF "B2B Customer" THEN
        ERROR(Text75005,"Customer No.","No.");

      //DOC EC2009.2.74 -
      InternetSetup.GET;
      IF InternetSetup."Use Internet Customer" =
         InternetSetup."Use Internet Customer"::Always THEN
        EXIT;
      //DOC EC2009.2.74 +


      IF NOT Customer.GET("Customer No.") THEN
        ERROR(Text75004,"Customer No.");

      IF (Customer."Label Code" = '')  THEN
        Customer.VALIDATE("Label Code","Label Code")
      ELSE
        IF (Customer."Label Code" <> "Label Code") THEN
          ERROR(Text75006,FIELDCAPTION("Label Code"),Customer.TABLECAPTION,Customer."Label Code",
                TABLECAPTION,"Label Code");

      LabelRec.GET("Label Code");
      IF LabelRec."Update Cust From Template" THEN BEGIN
        IF "Country Code" <> Customer."Country/Region Code" THEN BEGIN
          IF CountryRegionRec.GET("Country Code") THEN BEGIN
            IF CountryRegionRec."Use Online" = FALSE THEN
              ERROR(Text75007,"No.","Country Code");
            IF CountryRegionRec."B2C Customer Template" <> '' THEN BEGIN
              CustTemplate.GET(CountryRegionRec."B2C Customer Template");
              Customer."Customer Posting Group" := CustTemplate."Customer Posting Group";
              Customer."Customer Price Group" := CustTemplate."Customer Price Group";
              Customer."Invoice Disc. Code" := CustTemplate."Invoice Disc. Code";
              Customer."Customer Disc. Group" := CustTemplate."Customer Disc. Group";
              Customer."Allow Line Disc." := CustTemplate."Allow Line Disc.";
              Customer."Gen. Bus. Posting Group" := CustTemplate."Gen. Bus. Posting Group";
              Customer."VAT Bus. Posting Group" := CustTemplate."VAT Bus. Posting Group";
              Customer."Payment Terms Code" := CustTemplate."Payment Terms Code";
              Customer."Payment Method Code" := CustTemplate."Payment Method Code";
              Customer."Shipment Method Code" := CustTemplate."Shipment Method Code";
              Customer."Loyalty Scheme Code" := CustTemplate."Loyalty Scheme Code";

              DefaultDimen.SETRANGE("Table ID",DATABASE::"Customer Template");
              DefaultDimen.SETRANGE("No.",CustTemplate.Code);
              IF DefaultDimen.FIND('-') THEN
              REPEAT
                IF DefaultDimen2.GET(DATABASE::Customer,Customer."No.",DefaultDimen."Dimension Code") THEN BEGIN
                  DefaultDimen2.VALIDATE("Dimension Value Code",DefaultDimen."Dimension Value Code");
                  DefaultDimen2."Value Posting" := DefaultDimen."Value Posting";
                  DefaultDimen2.MODIFY(TRUE);
                END ELSE BEGIN
                  CLEAR(DefaultDimen2);
                  DefaultDimen2.INIT;
                  DefaultDimen2.VALIDATE("Table ID",DATABASE::Customer);
                  DefaultDimen2."No." := Customer."No.";
                  DefaultDimen2.VALIDATE("Dimension Code",DefaultDimen."Dimension Code");
                  DefaultDimen2.VALIDATE("Dimension Value Code",DefaultDimen."Dimension Value Code");
                  DefaultDimen2."Value Posting" := DefaultDimen."Value Posting";
                  DefaultDimen2.INSERT(TRUE);
                END;
              UNTIL DefaultDimen.NEXT = 0;
              Customer.MODIFY;
            END;
          END;
        END;
      END;
      Customer.TRANSFERFIELDS(Rec);


      Customer."No." := "Customer No.";
      IF Customer."User GUID" <> "No." THEN
        Customer."User GUID" := "No.";
      IF Customer.Name='' THEN
        Customer.Name:=Contact;
      IF "Salesperson Code" <> '' THEN
        Customer.VALIDATE("Salesperson Code","Salesperson Code");
      IF Customer."Is An Internet Customer" = FALSE THEN
        Customer.VALIDATE("Is An Internet Customer",TRUE);
        //could be customer specific code in the "Is An Internet Customer"
      Customer.MODIFY;
    END;

    PROCEDURE UpdateToCustomerYesNo@12();
    BEGIN
      CALCFIELDS("B2B Customer");
      TESTFIELD("B2B Customer",FALSE);

      IF "Customer No." <> '' THEN BEGIN
        InternetSetup.GET;
        IF InternetSetup."Use Internet Customer" <>
           InternetSetup."Use Internet Customer"::Always THEN BEGIN
          IF (CurrFieldNo = 0) THEN BEGIN
            UpdateToCustomer;
          END ELSE BEGIN
            IF CONFIRM(Text004,TRUE,Rec.TABLECAPTION,
                       "Customer No.",Customer.TABLECAPTION) THEN
              UpdateToCustomer;
          END;
        END;
      END ELSE
        MESSAGE(Text005,Customer.TABLECAPTION,Rec.TABLECAPTION);

      IF Customer.GET(xRec."Customer No.") THEN BEGIN
        Customer."User GUID" := '';
        Customer."Label Code" := '';
        Customer.VALIDATE("Is An Internet Customer",FALSE);
        Customer.MODIFY;
      END;
    END;

    PROCEDURE "B2B Enable"@4();
    BEGIN
      TESTFIELD("Contact No.");
      TESTFIELD("Customer No.");
      TESTFIELD("Label Code");
      Customer.GET("Customer No.");
      Customer.TESTFIELD("Is An Internet Customer");

      //DOC EC2013.3.61 -
      CLEAR(InternetCustB2BRec);
      InternetCustB2BRec.RESET;
      InternetCustB2BRec.SETRANGE("Label Code","Label Code");
      InternetCustB2BRec.SETRANGE("Code Login",Login);
      InternetCustB2BRec.SETRANGE(Enable,TRUE);
      IF InternetCustB2BRec.FINDFIRST THEN
        ERROR(Text022);
      CLEAR(InternetCustB2BRec);
      //DOC EC2013.3.61 +

      IF CONFIRM(Text006) THEN BEGIN
        InternetCustB2BRec.INIT;
        InternetCustB2BRec."No." := "No.";
        InternetCustB2BRec."Customer No." := "Customer No.";
        InternetCustB2BRec.Contact := Contact;
        InternetCustB2BRec."E-Mail" := "E-Mail";
        InternetCustB2BRec.Login := Login;
        //DOC EC2013.4.67 - take out VALIDATE cos this encrypts the already encrypted password
        //InternetCustB2BRec.VALIDATE(Password,Password);  //DOC EC2013.3.61 changed to VALIDATE
        InternetCustB2BRec.Password := Password;
        InternetCustB2BRec."Password Version" := COPYSTR(CREATEGUID,2,36);
        //DOC EC2013.4.67 +
        InternetCustB2BRec."Label Code" := "Label Code";
        InternetCustB2BRec."Contact No." := "Contact No.";
        //DOC EC2009.2.72 -
        InternetCustB2BRec."Code Login" := Login;
        InternetCustB2BRec.DateTimeInsertedModified := CURRENTDATETIME;
        InternetCustB2BRec."Inserted Modified By" := USERID;
        //DOC EC2009.2.72 +

        InternetCustB2BRec.INSERT(TRUE); //DOC EC2013.3.61 add TRUE
        IF(NOT Customer."Is a B2B Internet Customer") THEN BEGIN
          Customer."Is a B2B Internet Customer" := TRUE;
          Customer.MODIFY(TRUE);
        END
      END;
    END;

    PROCEDURE CreateContact@1040001();
    BEGIN
      TESTFIELD("Label Code");

      CALCFIELDS("B2B Customer");
      IF "B2B Customer" THEN BEGIN
        IF "Contact No." = '' THEN BEGIN
          InternetCustB2BRec.GET("No.");
          InternetCustB2BRec.TESTFIELD("Contact No."); //DOC EC2009.2.72 MQ 19/03/2012 - GW120319 make more robust
          VALIDATE("Contact No.",InternetCustB2BRec."Contact No.");
          IF "Customer No." = '' THEN
            "Customer No." := InternetCustB2BRec."Customer No."
          ELSE
            IF "Customer No." <> InternetCustB2BRec."Customer No." THEN
              ERROR(Text75011,"No.");
        END;
      END ELSE BEGIN
        ContactRec.RESET;
        ContactRec.SETCURRENTKEY("User GuID");
        ContactRec.SETRANGE("User GuID","No.");
        //DOC EC2009.2.72 - MQ 19/03/2012 - GW120319 make more robust
        IF ContactRec.COUNT > 1 THEN
          ERROR(Text75013);
        //DOC EC2009.2.72 +
        IF ContactRec.FINDFIRST THEN BEGIN
          IF ContactRec."Label Code" = '' THEN
            ContactRec."Label Code" := "Label Code"
          ELSE
            ContactRec.TESTFIELD("Label Code","Label Code");
          ContactRec.VALIDATE("Is An Internet Customer",TRUE); //Validate as may have Cust specific code

          //DOC EC2009.2.72 -
          //Orig ContactRec.Name := Contact;
          IF Name = '' THEN
            ContactRec.Name := Contact
          ELSE
            ContactRec.Name := Name;
          ContactRec."Name 2" := Contact;
          //DOC EC2009.2.72 +

          ContactRec.MODIFY;
          VALIDATE("Contact No.",ContactRec."No.");
          MODIFY;
        END ELSE BEGIN
          ContactRec.RESET;
          ContactRec.SETRANGE("User GuID");
          IF FindContact(Rec,ContactRec,FALSE) THEN BEGIN
            IF NOT "B2B Registration" THEN BEGIN  //DOC EC2013.4.00
              UpdateToContact;
              AddSegmentsForNewInternetCust;
            END; //DOC EC2013.4.00
          END ELSE
            CreateContact2;
        END;
      END;
    END;

    PROCEDURE CreateContact2@1040002();
    BEGIN
      CALCFIELDS("B2B Customer");
      IF "B2B Customer" THEN
        ERROR(Text75001);

      InternetSetup.GET;
      InternetSetup.TESTFIELD("New Contact Nos.");
      CLEAR(NoSeriesMgt);
      ContactRec."No." := NoSeriesMgt.GetNextNo(InternetSetup."New Contact Nos.",0D,TRUE);
      ContactRec."No. Series" := InternetSetup."New Contact Nos.";

      "Contact No." := ContactRec."No.";

      IF "Last DateTime Modified" <> 0DT THEN
        "Last Date Modified" := DT2DATE("Last DateTime Modified");
      MODIFY;

      ContactRec.TRANSFERFIELDS(Rec);

      ContactRec."Search E-Mail" := "E-Mail";
      ContactRec."Salesperson Code":="Salesperson Code";
      ContactRec."No." := "Contact No.";
      ContactRec.INSERT(TRUE);
      //DOC EC2013.3.40 -
      IF "B2B Registration" THEN BEGIN
        ContactRec."User GuID" := CREATEGUID;
        ContactRec."User GuID" := COPYSTR(ContactRec."User GuID",2,36);
        RMSetup.GET;
      END ELSE BEGIN
        ContactRec."Created from Internet Customer" := TRUE;  //moved from lower down
      //DOC EC2013.3.40 +
        ContactRec."User GuID" := "No.";
      END;

      IF Name = '' THEN
        ContactRec.Name := Contact;
      ContactRec."Name 2" := Contact;
      //DOC EC2013.3.40 -
      IF "B2B Registration" THEN
        ContactRec."Label Code" := "Label Code"
      ELSE
      //DOC EC2013.3.40 +
        ContactRec.VALIDATE("Label Code","Label Code");
      ContactRec."Is An Internet Customer" := TRUE;
      //DOC EC2013.3.40 ContactRec."Created from Internet Customer" := TRUE;  moved higher up

      //DOC EC2009.2.74 -
      IF InternetSetup."Use Internet Customer" = InternetSetup."Use Internet Customer"::Always THEN BEGIN
        InternetSetup.TESTFIELD("Internet Customer");
        InternetSetup.TESTFIELD("Internet Contact Company No.");
        "Customer No." := InternetSetup."Internet Customer";
        MODIFY;
        ContactRec.Type := ContactRec.Type::Person;
        ContactRec."Company No." := InternetSetup."Internet Contact Company No.";
      END;
      //DOC EC2009.2.74 +
      ContactRec.MODIFY;

      //DOC EC2013.3.40 -
      IF "B2B Registration" THEN BEGIN
        //Create Customer as well
        CountryRegionRec.GET("Country Code");
        CountryRegionRec.TESTFIELD("B2B Customer Template");
        ContactRec.SetHideValidationDialog(TRUE);
        ContactRec.CreateCustomer(CountryRegionRec."B2B Customer Template");
        ContBusRelRec.RESET;
        ContBusRelRec.GET("Contact No.",RMSetup."Bus. Rel. Code for Customers");
        "Customer No." := ContBusRelRec."No.";

        IF InternetSetup."Maintain Label Dimensions" THEN BEGIN
          DefaultDimen.INIT;
          DefaultDimen."Table ID" := 18;
          DefaultDimen."No." := "Customer No.";
          DefaultDimen."Dimension Code" := 'LABEL';
          DefaultDimen."Dimension Value Code" := "Label Code";
          IF DefaultDimen.INSERT THEN;
        END;

        //Mark Customer as Internet B2B Customer
        Customer.GET("Customer No.");
        Customer."Is a B2B Internet Customer" := TRUE;
        //DOC EC2013.3.80 taken out for initial SKS data import Customer.Blocked := Customer.Blocked::All;
        Customer.Blocked := Customer.Blocked::All; //DOC EC2013.4.50 Now put back

        Customer.MODIFY;

        //Create Contact for Internet B2B Customer
        ContactRec2.INIT;
        CLEAR(NoSeriesMgt);
        ContactRec2."No." := NoSeriesMgt.GetNextNo(RMSetup."Contact Nos.",0D,TRUE);
        ContactRec2."No. Series" := RMSetup."Contact Nos.";
        ContactRec2.INSERT(TRUE);
        ContactRec2."Company No." := ContactRec."No.";
        ContactRec2.VALIDATE(Type,ContactRec2.Type::Person);
        ContactRec2."User GuID" := "No.";
        ContactRec2.InheritCompanyToPersonData(ContactRec,FALSE);
        ContactRec2.VALIDATE("E-Mail","E-Mail");
        ContactRec2.VALIDATE(Name,Contact);
        ContactRec2."Label Code" := "Label Code";
        ContactRec2."Is An Internet Customer" := TRUE;
        ContactRec2."Created from Internet Customer" := TRUE;
        ContactRec2."Last Date Modified" := TODAY;
        ContactRec2.MODIFY;
        "Contact No." := ContactRec2."No.";

        //Create Internet B2B Customer
        //DOC EC2013.3.61 -
        CLEAR(InternetCustB2BRec);
        InternetCustB2BRec.RESET;
        InternetCustB2BRec.SETRANGE("Label Code","Label Code");
        InternetCustB2BRec.SETRANGE("Code Login",Login);
        InternetCustB2BRec.SETRANGE(Enable,TRUE);
        IF InternetCustB2BRec.FINDFIRST THEN
          ERROR(Text022);
        CLEAR(InternetCustB2BRec);
        //DOC EC2013.3.61 +
        InternetCustB2BRec.INIT;
        InternetCustB2BRec."No." := "No.";
        InternetCustB2BRec."Customer No." := "Customer No.";
        InternetCustB2BRec.Contact := Contact;
        InternetCustB2BRec."E-Mail" := "E-Mail";
        InternetCustB2BRec.Login := Login;
        InternetCustB2BRec."Code Login" := Login;
        InternetCustB2BRec.Password := Password;
        //DOC EC2013.4.67 InternetCustB2BRec."Password Version" := Password; //DOC EC2013.3.61
        InternetCustB2BRec."Password Version" := COPYSTR(Password,1,38); //DOC EC2013.4.67
        InternetCustB2BRec."Label Code" := "Label Code";
        InternetCustB2BRec."Contact No." := ContactRec2."No.";
        InternetCustB2BRec.Enable := TRUE;
        InternetCustB2BRec.DateTimeInsertedModified := CURRENTDATETIME;
        InternetCustB2BRec."Inserted Modified By" := 'FROM WEB';
        InternetCustB2BRec.INSERT;

        //Create IPI
        IssueText := STRSUBSTNO(Text75014,"Customer No.");
        //DOC EC2013.3.80 taken out for initial SKS data import CreateIPI(2,"No.",'','','',IssueText,FALSE,FALSE);
        CreateIPI(2,"No.",'','','',IssueText,FALSE,FALSE); //DOC EC2013.4.50 now put back

      END;
      MODIFY;  //DOC EC2013.3.40 moved from higher up
      //DOC EC2013.3.40 +

      AddSegmentsForNewInternetCust;
    END;

    PROCEDURE FindContact@1040003(VAR InternetCustomer@1000000000 : Record 9021642;VAR ContactRec@1000000001 : Record 5050;Automatic@1040001 : Boolean) : Boolean;
    VAR
      "Contact No."@1000000002 : Code[20];
      Found@1000000003 : Boolean;
      OK@1000000004 : Boolean;
      InternetCustomer2@1040000 : Record 9021642;
      VersionCalls@1000000005 : Codeunit 9021662;
    BEGIN
      TempContRec.RESET;
      TempContRec.DELETEALL;

      ContactRec.RESET;
      ContactRec.SETFILTER("Label Code",'%1|%2','',"Label Code");
      IF "B2B Registration" = FALSE THEN //DOC EC2013.4.00
      ContactRec.SETRANGE("User GuID",'');
      ContactRec.SETRANGE(Type,ContactRec.Type::Company);
      Found := FALSE;
      OK := FALSE;

      //NOTE: may need to add keys here.
      // Match on Phone No.
      InternetCustomer2 := InternetCustomer;
      IF STRLEN(InternetCustomer2."Phone No.") > 4 THEN BEGIN
        ContactRec.SETCURRENTKEY("Phone No.");
        ContactRec.SETRANGE("Phone No.",InternetCustomer2."Phone No.");
        Found := Found OR MatchContact(ContactRec);
        ContactRec.SETRANGE("Phone No.");
      END;

      // Match on E-Mail
      IF InternetCustomer2."E-Mail" <> '' THEN BEGIN
        ContactRec.SETCURRENTKEY("Search E-Mail");
        ContactRec.SETRANGE("Search E-Mail",UPPERCASE(InternetCustomer2."E-Mail"));
        Found := Found OR MatchContact(ContactRec);
        ContactRec.SETRANGE("E-Mail");
      END;

      // Match on Post Code
      IF STRLEN(InternetCustomer2."Post Code") > 4 THEN BEGIN
        ContactRec.SETCURRENTKEY("Post Code");
        ContactRec.SETRANGE("Post Code",InternetCustomer2."Post Code");
        Found := Found OR MatchContact(ContactRec);
        ContactRec.SETRANGE("Post Code");
      END;

      IF Automatic THEN BEGIN
        IF Found THEN
          OK := TRUE;
        TempContRec.DELETEALL;
        EXIT(OK);
      END;

      ContactRec.SETRANGE("User GuID");
      ContactRec.SETRANGE("Label Code");

      IF Found THEN BEGIN
        IF CONFIRM(Text001 + Text002,
             TRUE,ContactRec.TABLECAPTION,TABLECAPTION)
        THEN BEGIN
          IF VersionCalls.IntCustsFindContact(TempContRec) THEN BEGIN  //DOC EC2013.4.00
          //DOC EC2013.4.00 IF FORM.RUNMODAL(FORM::"Contact List",TempContRec) = ACTION::LookupOK THEN BEGIN
            InternetCustomer.VALIDATE("Contact No.",TempContRec."No.");
            InternetCustomer.MODIFY;
            OK := TRUE;
          END ELSE
            ERROR(Text003,ContactRec.TABLECAPTION,TABLECAPTION);
        END;
      END;

      TempContRec.DELETEALL;
      EXIT(OK);
    END;

    LOCAL PROCEDURE MatchContact@1040004(VAR ContactRec@1000000000 : Record 5050) : Boolean;
    VAR
      Found@1000000001 : Boolean;
    BEGIN
      IF ContactRec.FIND('-') THEN BEGIN
        REPEAT
          TempContRec := ContactRec;
          IF TempContRec.INSERT THEN;
        UNTIL ContactRec.NEXT = 0;
        Found := TRUE;
      END;
      EXIT(Found);
    END;

    PROCEDURE UpdateToContact@1040006();
    BEGIN
      IF "Contact No." = '' THEN
        EXIT;

      CALCFIELDS("B2B Customer");
      IF "B2B Customer" THEN
        ERROR(Text75009,"Contact No.","No.");

      IF NOT ContactRec2.GET("Contact No.") THEN
        ERROR(Text75010,"Contact No.");

      //DOC EC2009.2.74 -
      InternetSetup.GET;
      IF InternetSetup."Use Internet Customer" =
         InternetSetup."Use Internet Customer"::Never THEN
      //DOC EC2009.2.74 +
      ContactRec2.TESTFIELD(Type,ContactRec2.Type::Company);
      //Do not need validate and Transferfields will do it ContactRec2.VALIDATE("E-Mail","E-Mail");
      ContactRec2.TRANSFERFIELDS(Rec);
      ContactRec2."Search E-Mail" := "E-Mail";
      ContactRec2."No." := "Contact No.";
      ContactRec2."Label Code" := "Label Code";
      //DOC EC2009.2.72 -
      IF Name = '' THEN
        ContactRec2.Name := Contact;
      //DOC EC2009.2.72 +
      ContactRec2."Name 2" := Contact;
      ContactRec2."User GuID" := "No.";
      IF "Salesperson Code" <> '' THEN
        ContactRec2."Salesperson Code" := "Salesperson Code";

      ContactRec2.VALIDATE("Is An Internet Customer",TRUE); //keep Validate as there maybe Cust. specific code on OnValidate
      ContactRec2.MODIFY;
      LocalSegmentLineRec1.RESET;
      LocalSegmentLineRec1.SETRANGE("Contact No.","Contact No.");
      LocalSegmentLineRec1.SETCURRENTKEY("Contact No.");
      IF LocalSegmentLineRec1.FIND('-') THEN
      REPEAT
        LocalSegmentLineRec2 := LocalSegmentLineRec1;
        LocalSegmentLineRec2."Company User GuID" := "No.";
        LocalSegmentLineRec2.MODIFY;
      UNTIL LocalSegmentLineRec1.NEXT = 0;
    END;

    PROCEDURE UpdateToContactYesNo@1040007();
    BEGIN
      IF "Contact No." = '' THEN BEGIN
        IF ContactRec.GET(xRec."Contact No.") THEN BEGIN
          ContactRec."User GuID" := '';
          ContactRec.VALIDATE("Is An Internet Customer",FALSE);
          ContactRec."Label Code" := '';
          ContactRec.MODIFY;
          ERROR('%1',ContactRec."User GuID");
        END;
      END ELSE
        UpdateToContact;
    END;

    PROCEDURE AddSegmentsForNewInternetCust@1040005();
    VAR
      LocalCustRec@1040000 : Record 18;
      LocalSegLineRec1@1040001 : Record 5077;
      LocalSegLineRec2@1040002 : Record 5077;
      LocalSegLineRec3@1040003 : Record 5077;
      LocalSegLineRec4@1040004 : Record 5077;
    BEGIN
      IF LabelRec."Default Customer" = '' THEN BEGIN
        LabelRec.GET("Label Code");
        LabelRec.TESTFIELD("Default Customer");
      END;

      LocalSegLineRec2.RESET;
      LocalSegLineRec2.SETCURRENTKEY("Contact No.","Segment No.");
      //DOC EC2013.3.20 MQ 21/09/2012 - GW120921 since LocalSegLineRec1 is not used yet it should be blank
      //so cannot see point of next line so commented out.
      //LocalSegLineRec2.SETRANGE("Segment No.",LocalSegLineRec1."Segment No.");
      LocalSegLineRec2.SETRANGE("Contact No.","Contact No.");
      LocalSegLineRec2.MODIFYALL("Company User GuID","No.");

      LocalSegLineRec2.RESET;
      //DOC EC2013.3.20 MQ 21/09/2012 - GW120921 setcurrentkey as primary key - not sure why this is necessary
      LocalSegLineRec2.SETCURRENTKEY("Segment No.","Line No.");

      LocalSegLineRec4.RESET;
      LocalSegLineRec4.SETCURRENTKEY("Contact No.","Segment No.");

      LocalCustRec.GET(LabelRec."Default Customer");
      LocalCustRec.TESTFIELD("User GUID");
      LocalSegLineRec1.RESET;
      LocalSegLineRec1.SETRANGE("Company User GuID",LocalCustRec."User GUID");
      LocalSegLineRec1.SETCURRENTKEY("Company User GuID");
      IF LocalSegLineRec1.FIND('-') THEN
      REPEAT
        LocalSegLineRec4.SETRANGE("Contact No.","Contact No.");
        LocalSegLineRec4.SETRANGE("Segment No.",LocalSegLineRec1."Segment No.");
        IF NOT LocalSegLineRec4.FINDFIRST THEN BEGIN
          LocalSegLineRec2.SETRANGE("Segment No.",LocalSegLineRec1."Segment No.");
          LocalSegLineRec2.FINDLAST;
          LocalSegLineRec3.INIT;
          LocalSegLineRec3.TRANSFERFIELDS(LocalSegLineRec1);
          //DOC EC2013.3.10 MQ 21/09/2012 - GW120921 changed this from + 10000 to +16
          LocalSegLineRec3."Line No." := LocalSegLineRec2."Line No." + 16;
          LocalSegLineRec3.VALIDATE("Contact No.","Contact No.");
          LocalSegLineRec3.INSERT;
        END;
      UNTIL LocalSegLineRec1.NEXT = 0;
    END;

    PROCEDURE ClearContactNo@1000000001();
    VAR
      TextL000@1000000000 : TextConst 'ENU=The Customer No. must be blank before you can clear the Contact No.;ENG=The Customer No. must be blank before you can clear the Contact No.';
    BEGIN
      CALCFIELDS("B2B Customer");
      IF "B2B Customer" THEN
        ERROR(Text75008,FIELDCAPTION("Contact No."));

      IF "Customer No." <> '' THEN
        ERROR(TextL000);
      VALIDATE("Contact No.",'');
      MODIFY;
    END;

    PROCEDURE ClearCustomerNo@1000000002();
    BEGIN
      CALCFIELDS("B2B Customer");
      IF "B2B Customer" THEN
        ERROR(Text75008,FIELDCAPTION("Customer No."));
      VALIDATE("Customer No.",'');
      MODIFY;
    END;

    PROCEDURE CreateIPI@1000000000(Type@1040000 : 'Internet Order,Cust. Subscription,Customer,Subscription,Questionnaire Answer,Sales,Payment,Web Update,Promo Warning,Warning';Code1@1040001 : Text[50];Code2@1040002 : Text[50];Code3@1040003 : Text[50];IntCustNo@1040005 : Text[38];ErrorDescription@1040004 : Text[250];AutoClear@1190000005 : Boolean;MakeHidden@1190000006 : Boolean);
    VAR
      IntProcessIssue@1000000000 : Record 9021669;
    BEGIN
      IntProcessIssue.RESET;
      IntProcessIssue.SETCURRENTKEY(Type,"Code 1","Code 2","Code 3");
      IntProcessIssue.SETRANGE(Type,Type);
      IntProcessIssue.SETRANGE("Code 1",Code1);
      IntProcessIssue.SETRANGE("Code 2",Code2);
      IntProcessIssue.SETRANGE("Code 3",Code3);
      IntProcessIssue.SETRANGE(Status,IntProcessIssue.Status::Open);
      IF IntProcessIssue.FINDFIRST THEN
        IntProcessIssue.DELETEALL;

      IntProcessIssue.INIT;
      IntProcessIssue.Type := Type;
      EVALUATE(IntProcessIssue."Code 1",Code1);
      EVALUATE(IntProcessIssue."Code 2",Code2);
      EVALUATE(IntProcessIssue."Code 3",Code3);
      IntProcessIssue."Internet Customer No." := IntCustNo;
      IntProcessIssue.Description := ErrorDescription;
      IntProcessIssue."Date Time Created" := CURRENTDATETIME;
      IntProcessIssue."Auto Clear" := AutoClear;
      IntProcessIssue.Hide := MakeHidden;
      IntProcessIssue.INSERT(TRUE);
    END;

    BEGIN
    {
      MQ 13/06/2014 - GW140613 - this has not been done - EE13.0.13 MPF 20130528
        - Following functions have been removed:
            CreateCustomer, CreateCustomer2, FindCustomer, Match, EISEAutoCreateCustomer,
            GetSellToCustomer
          Their functionality have been moved to 14115280 EECM-User Management.
      <<EE13.0.13


      //DOC EC2009.2.72 MQ 01/01/2012 - Do not leave Name empty when updating Contact from Internet Customer; Additional code in "B2B Enable" and in CreateContact
      //DOC EC2009.2.74 MQ 01/01/2012 - Change code in CreateCustomer to deal with InternetSetup.Use Internet Customer::Always
      //DOC EC2009.2.74 MQ 01/01/2012 - Change code in CreateContact2 and UpdateToContact and UpdateToCustomer
      //DOC EC2013.3.20 MQ 21/09/2012 - GW120921 changed AddSegmentsForNewInternetCust to slow down growth of extra lines
      //DOC EC2013.3.20 MQ 17/10/2012 - GW121017 added s to table caption name
      //DOC EC2013.3.20 MQ 31/10/2012 - GW121031 add field B2B Registration
      //DOC EC2013.3.40 MQ 17/01/2013 - GW130117 Some updates and creation of B2B Customer if B2B Registration is ticked.
      //DOC EC2013.3.40 MQ 17/01/2013 - And deleted function CreateCustomer2 - it started with an Error
      //DOC EC2013.3.61 MQ 19/07/2013 - GW130719 When creating B2B via B2B Registration, check email is not already being used.
      //DOC EC2013.3.61 MQ 19/07/2013 - Delete functions FindCustomer, Match and FindSellToCustomerNo
      //DOC EC2013.3.80 MQ 14/08/2013 - GW130814 Add field 200 - not on any forms but useful when excluding Internet Customers from certain checks.
      //DOC EC2013.3.80 MQ 25/10/2013 - GW131025 take out bit of code on B2B registration for initial SKS data import
      //DOC EC2013.4.00 MQ 04/11/2013 - GW131104 Removed global not used and RTC
      //DOC EC2013.4.00 MQ 17/12/2013 - GW131217 Enhanced B2B Registration if find a contact to link to.
      //DOC EC2013.4.50 MQ 06/01/2014 - GW140106 Extra code to stop error that Customer does not exist.
      //DOC EC2013.4.50 MQ 20/01/2014 - GW140120 put back SKS code
      //DOC EC2013.4.64 MQ 06/06/2014 - GW140606 Restrict Password to Password Version to 38 characters
      //DOC EC2013.4.67 MQ 26/09/2014 - GW140926 Restrict Password to Password Version to 38 characters in another place
      //DOC EC2013.4.67 MQ 29/09/2014 - GW140929 Change in function B2B Enable
      //DOC EC2016.6    JH 05/10/2016 - ECom 2016
    }
    END.
  }
}

